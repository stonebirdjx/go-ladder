<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [å‰è¨€](#%E5%89%8D%E8%A8%80)
- [HelloWorld](#helloworld)
- [å°åˆ€å¼‘ç‰›](#%E5%B0%8F%E5%88%80%E5%BC%91%E7%89%9B)
- [package - åŒ…](#package---%E5%8C%85)
  - [åŒ…å£°æ˜](#%E5%8C%85%E5%A3%B0%E6%98%8E)
  - [å¯¼å‡ºç¬¦å·](#%E5%AF%BC%E5%87%BA%E7%AC%A6%E5%8F%B7)
  - [initå‡½æ•° - åˆå§‹åŒ–åŒ…](#init%E5%87%BD%E6%95%B0---%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8C%85)
  - [å†…éƒ¨åŒ…](#%E5%86%85%E9%83%A8%E5%8C%85)
  - [å¯¼å…¥åŒ…](#%E5%AF%BC%E5%85%A5%E5%8C%85)
  - [module - æ¨¡å—](#module---%E6%A8%A1%E5%9D%97)
  - [go work - å·¥ä½œç©ºé—´](#go-work---%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4)
  - [go vendor - æ‰“åŒ…ä¾èµ–æºç ](#go-vendor---%E6%89%93%E5%8C%85%E4%BE%9D%E8%B5%96%E6%BA%90%E7%A0%81)
  - [åŒ…ç›¸å…³çš„ç¯å¢ƒå˜é‡](#%E5%8C%85%E7%9B%B8%E5%85%B3%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F)
  - [:point_right:åŒ…æ€»ç»“](#point_right%E5%8C%85%E6%80%BB%E7%BB%93)
- [ğŸ‘‰å„ç§ç±»å‹çš„å†…å­˜é•¿åº¦å’Œé›¶å€¼](#%E5%90%84%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%86%85%E5%AD%98%E9%95%BF%E5%BA%A6%E5%92%8C%E9%9B%B6%E5%80%BC)
- [ğŸ‘‰ä½œç”¨åŸŸï¼ˆç§»åŠ¨ä½ç½®ï¼‰](#%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%A7%BB%E5%8A%A8%E4%BD%8D%E7%BD%AE)
- [å˜é‡](#%E5%8F%98%E9%87%8F)
  - [å˜é‡å£°æ˜](#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E)
  - [ç®€çŸ­å˜é‡å£°æ˜](#%E7%AE%80%E7%9F%AD%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E)
  - [:point_right:å˜é‡æ€»ç»“](#point_right%E5%8F%98%E9%87%8F%E6%80%BB%E7%BB%93)
- [å¸¸é‡å’Œiota](#%E5%B8%B8%E9%87%8F%E5%92%8Ciota)
  - [å¸¸é‡å®šä¹‰](#%E5%B8%B8%E9%87%8F%E5%AE%9A%E4%B9%89)
  - [iota](#iota)
  - [:point_right:æ— ç±»å‹å¸¸é‡](#point_right%E6%97%A0%E7%B1%BB%E5%9E%8B%E5%B8%B8%E9%87%8F)
  - [:point_right:å¸¸é‡æ€»ç»“](#point_right%E5%B8%B8%E9%87%8F%E6%80%BB%E7%BB%93)
- [æ•°å­—ç±»å‹](#%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B)
  - [æ•´å‹](#%E6%95%B4%E5%9E%8B)
    - [æœ‰ç¬¦å·æ•´å‹ & æ— ç¬¦å·æ•´å‹](#%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B4%E5%9E%8B--%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B4%E5%9E%8B)
    - [è¿ç®—ç¬¦](#%E8%BF%90%E7%AE%97%E7%AC%A6)
    - [æ•´æ•°å®‰å…¨](#%E6%95%B4%E6%95%B0%E5%AE%89%E5%85%A8)
    - [å…«è¿›åˆ¶](#%E5%85%AB%E8%BF%9B%E5%88%B6)
    - [åå…­è¿›åˆ¶](#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6)
    - [:point_right:æ•´å‹æ€»ç»“](#point_right%E6%95%B4%E5%9E%8B%E6%80%BB%E7%BB%93)
  - [æµ®ç‚¹æ•°](#%E6%B5%AE%E7%82%B9%E6%95%B0)
    - [æµ®ç‚¹æ•°ç±»å‹](#%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B)
    - [æ­£æ— ç©·å¤§ã€è´Ÿæ— ç©·å¤§å’Œéæ•°](#%E6%AD%A3%E6%97%A0%E7%A9%B7%E5%A4%A7%E8%B4%9F%E6%97%A0%E7%A9%B7%E5%A4%A7%E5%92%8C%E9%9D%9E%E6%95%B0)
    - [:point_right:æµ®ç‚¹æ•°æ€»ç»“](#point_right%E6%B5%AE%E7%82%B9%E6%95%B0%E6%80%BB%E7%BB%93)
  - [å¤æ•°](#%E5%A4%8D%E6%95%B0)
  - [:point_right:å¸ƒå°”å‹](#point_right%E5%B8%83%E5%B0%94%E5%9E%8B)
- [å­—ç¬¦ä¸²](#%E5%AD%97%E7%AC%A6%E4%B8%B2)
  - [ç»“æ„](#%E7%BB%93%E6%9E%84)
  - [åŸå§‹å­—ç¬¦ä¸²raw](#%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2raw)
  - [å­ä¸²å†…éƒ¨æŒ‡é’ˆä¾æ—§æŒ‡å‘åŸå­—èŠ‚æ•°ç»„](#%E5%AD%90%E4%B8%B2%E5%86%85%E9%83%A8%E6%8C%87%E9%92%88%E4%BE%9D%E6%97%A7%E6%8C%87%E5%90%91%E5%8E%9F%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84)
  - [foréå†çš„ä¸¤ç§æ–¹å¼](#for%E9%81%8D%E5%8E%86%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F)
  - [å­—ç¬¦ä¸²è½¬ä¹‰](#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E4%B9%89)
  - [Unicode](#unicode)
  - [UTF-8](#utf-8)
  - [:point_right:å­—ç¬¦ä¸²æ€»ç»“](#point_right%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%80%BB%E7%BB%93)
- [æ•°ç»„](#%E6%95%B0%E7%BB%84)
  - [è¯­æ³•ç³–](#%E8%AF%AD%E6%B3%95%E7%B3%96)
  - [:point_right:ç»„æ•°æ€»ç»“](#point_right%E7%BB%84%E6%95%B0%E6%80%BB%E7%BB%93)
- [Slice](#slice)
  - [åº•å±‚æ•°æ®ç»“æ„](#%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84)
  - [appendå‡½æ•°](#append%E5%87%BD%E6%95%B0)
  - [copy](#copy)
  - [sliceæ€»ç»“](#slice%E6%80%BB%E7%BB%93)
- [map](#map)
  - [mapæ€»ç»“](#map%E6%80%BB%E7%BB%93)
- [ç»“æ„ä½“](#%E7%BB%93%E6%9E%84%E4%BD%93)
  - [åŒ¿åç»“æ„ä½“](#%E5%8C%BF%E5%90%8D%E7%BB%93%E6%9E%84%E4%BD%93)
  - [ç»“æ„ä½“æ¯”è¾ƒ](#%E7%BB%93%E6%9E%84%E4%BD%93%E6%AF%94%E8%BE%83)
  - [ç©ºç»“æ„ä½“](#%E7%A9%BA%E7%BB%93%E6%9E%84%E4%BD%93)
  - [Tag](#tag)
  - [ç»“æ„ä½“åµŒå¥—](#%E7%BB%93%E6%9E%84%E4%BD%93%E5%B5%8C%E5%A5%97)
  - [å†…å­˜å¯¹é½](#%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90)
  - [:point_right:ç»“æ„ä½“æ€»ç»“](#point_right%E7%BB%93%E6%9E%84%E4%BD%93%E6%80%BB%E7%BB%93)
- [:point_right:ç±»å‹è½¬æ¢](#point_right%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2)
    - [:point_right:è‡ªå®šä¹‰ç±»å‹å’Œåˆ«å](#point_right%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%88%AB%E5%90%8D)
    - [:point_right:ç±»å‹æ¯”è¾ƒ](#point_right%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83)
- [å‡½æ•°](#%E5%87%BD%E6%95%B0)
  - [å‡½æ•°å£°æ˜](#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E)
  - [:point_right:å€¼æ‹·è´ä¼ é€’](#point_right%E5%80%BC%E6%8B%B7%E8%B4%9D%E4%BC%A0%E9%80%92)
  - [:point_right:å¯å˜å‚æ•°](#point_right%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0)
  - [å‚æ•°ç”Ÿå‘½å‘¨æœŸ](#%E5%8F%82%E6%95%B0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F)
  - [å¤šè¿”å›å€¼](#%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC)
  - [å…·åè¿”å›å€¼](#%E5%85%B7%E5%90%8D%E8%BF%94%E5%9B%9E%E5%80%BC)
  - [:point_right:åŒ¿åå‡½æ•°](#point_right%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0)
  - [:point_right:é—­åŒ…](#point_right%E9%97%AD%E5%8C%85)
    - [é—­åŒ…åº”ç”¨](#%E9%97%AD%E5%8C%85%E5%BA%94%E7%94%A8)
  - [:point_right:defer å»¶è¿Ÿè°ƒç”¨](#point_rightdefer-%E5%BB%B6%E8%BF%9F%E8%B0%83%E7%94%A8)
    - [:point_right:å…·åè¿”å›ä¸‹çš„defer](#point_right%E5%85%B7%E5%90%8D%E8%BF%94%E5%9B%9E%E4%B8%8B%E7%9A%84defer)
  - [é”™è¯¯å¤„ç†](#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86)
  - [:point_right:panic/recover](#point_rightpanicrecover)
  - [:point_right:å‡½æ•°æ€»ç»“](#point_right%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93)
- [æ–¹æ³•](#%E6%96%B9%E6%B3%95)
  - [åŸºäºæŒ‡é’ˆå¯¹è±¡çš„æ–¹æ³•](#%E5%9F%BA%E4%BA%8E%E6%8C%87%E9%92%88%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95)
  - [åµŒå¥—å’ŒåŒ¿ååµŒå¥—](#%E5%B5%8C%E5%A5%97%E5%92%8C%E5%8C%BF%E5%90%8D%E5%B5%8C%E5%A5%97)
  - [:point_right:æ–¹æ³•é›†](#point_right%E6%96%B9%E6%B3%95%E9%9B%86)
    - [åˆ«åæ‰©å±•](#%E5%88%AB%E5%90%8D%E6%89%A9%E5%B1%95)
  - [æ–¹æ³•å€¼å’Œæ–¹æ³•è¡¨è¾¾å¼](#%E6%96%B9%E6%B3%95%E5%80%BC%E5%92%8C%E6%96%B9%E6%B3%95%E8%A1%A8%E8%BE%BE%E5%BC%8F)
  - [:point_right:æ–¹æ³•æ€»ç»“](#point_right%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93)
- [æ¥å£](#%E6%8E%A5%E5%8F%A3)
  - [ç©ºæ¥å£å¯ä»¥è¢«èµ‹å€¼ç»™ä»»ä½•å¯¹è±¡](#%E7%A9%BA%E6%8E%A5%E5%8F%A3%E5%8F%AF%E4%BB%A5%E8%A2%AB%E8%B5%8B%E5%80%BC%E7%BB%99%E4%BB%BB%E4%BD%95%E5%AF%B9%E8%B1%A1)
  - [ç©ºå€¼åˆ¤æ–­](#%E7%A9%BA%E5%80%BC%E5%88%A4%E6%96%AD)
  - [æ¥å£å®ç°](#%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0)
  - [ç±»å‹æ–­è¨€](#%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80)
  - [è®©ç¼–è¯‘å™¨æ£€æŸ¥](#%E8%AE%A9%E7%BC%96%E8%AF%91%E5%99%A8%E6%A3%80%E6%9F%A5)
  - [:point_right:æ¥å£æ€»ç»“](#point_right%E6%8E%A5%E5%8F%A3%E6%80%BB%E7%BB%93)
- [Channel - é€šé“](#channel---%E9%80%9A%E9%81%93)
  - [åŒæ­¥channel](#%E5%90%8C%E6%AD%A5channel)
  - [å¼‚æ­¥channel](#%E5%BC%82%E6%AD%A5channel)
  - [æ¶ˆæ¯æ”¶å‘](#%E6%B6%88%E6%81%AF%E6%94%B6%E5%8F%91)
  - [å•å‘channel](#%E5%8D%95%E5%90%91channel)
  - [selectå¤šè·¯å¤ç”¨](#select%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8)
  - [å…³é—­channel](#%E5%85%B3%E9%97%ADchannel)
  - [:point_right:channelæ€»ç»“](#point_rightchannel%E6%80%BB%E7%BB%93)
- [Goroutine - goç¨‹](#goroutine---go%E7%A8%8B)
  - [ç­‰å¾…ä»»åŠ¡ç»“æŸ](#%E7%AD%89%E5%BE%85%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9D%9F)
  - [ç»ˆæ­¢ä»»åŠ¡](#%E7%BB%88%E6%AD%A2%E4%BB%BB%E5%8A%A1)
  - [GOMAXPROCS - è¿›ç¨‹æ•°ï¼ˆingï¼‰](#gomaxprocs---%E8%BF%9B%E7%A8%8B%E6%95%B0ing)
  - [æŒ‚èµ·](#%E6%8C%82%E8%B5%B7)
  - [é¡ºåºæ‰§è¡Œ](#%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C)
  - [çº¿ç¨‹ç®¡ç†](#%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86)
  - [:point_right:goroutineæ€»ç»“](#point_rightgoroutine%E6%80%BB%E7%BB%93)
- [sync-å…±äº«å˜é‡å®‰å…¨](#sync-%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F%E5%AE%89%E5%85%A8)
  - [ç«äº‰æ£€æµ‹](#%E7%AB%9E%E4%BA%89%E6%A3%80%E6%B5%8B)
  - [sync.Mutexäº’æ–¥é”](#syncmutex%E4%BA%92%E6%96%A5%E9%94%81)
  - [sync.RWMutexè¯»å†™é”](#syncrwmutex%E8%AF%BB%E5%86%99%E9%94%81)
  - [sync.Condæ¡ä»¶å˜é‡](#synccond%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F)
  - [sync.Onceå•æ¬¡æ‰§è¡Œ](#synconce%E5%8D%95%E6%AC%A1%E6%89%A7%E8%A1%8C)
  - [sync.Poolå¤ç”¨ä¸´æ—¶å¯¹è±¡](#syncpool%E5%A4%8D%E7%94%A8%E4%B8%B4%E6%97%B6%E5%AF%B9%E8%B1%A1)
  - [sync.Mapå¹¶å‘å®‰å…¨çš„map](#syncmap%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E7%9A%84map)
  - [:point_right:é”æ€»ç»“](#point_right%E9%94%81%E6%80%BB%E7%BB%93)
- [æ³›å‹](#%E6%B3%9B%E5%9E%8B)
  - [ç±»å‹çº¦æŸ](#%E7%B1%BB%E5%9E%8B%E7%BA%A6%E6%9D%9F)
  - [æ³›å‹å‡½æ•°](#%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0)
  - [æ³›å‹ç±»å‹](#%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B)
  - [å£°æ˜æ³›å‹ç±»å‹é™åˆ¶ (type constraint)](#%E5%A3%B0%E6%98%8E%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B%E9%99%90%E5%88%B6-type-constraint)
  - [ç±»å‹è½¬æ¢](#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2)
  - [:point_right:æš‚ä¸æ”¯æŒæ³›å‹æ–¹æ³•](#point_right%E6%9A%82%E4%B8%8D%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95)
  - [:point_right:æ³›å‹æ€»ç»“](#point_right%E6%B3%9B%E5%9E%8B%E6%80%BB%E7%BB%93)
- [unsafe](#unsafe)
  - [unsafe.Sizeof, Alignof å’Œ Offsetof](#unsafesizeof-alignof-%E5%92%8C-offsetof)
  - [unsafe.Pointer](#unsafepointer)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# å‰è¨€

:speak_no_evil:å¦‚æœèƒ½æˆä¸ºgolangçš„cookbookå°±å¥½äº†:see_no_evil:

æ•´ç†çŸ¥è¯†ï¼Œä¼ æ’­æ™ºæ…§ï¼Œå¥½å¥½å­¦ä¹ ï¼Œå¤©å¤©å‘ä¸Šã€‚

åŸºäºgolang1.8+

å¯¹äºä¸€äº›è§„åˆ™æˆ–è€…è¦æ±‚ï¼Œå¯ä»¥å‚è€ƒ[å®‰å…¨ç¼–ç è§„èŒƒ](https://github.com/stonebirdjx/go-ladder/blob/master/golang%E5%AE%89%E5%85%A8%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83.md)

> æ–‡æ¡£ä¸ºä¸ªäººå¹³æ—¶ç”Ÿæ´»æ”¶é›†å’Œå·¥ä½œç§¯ç´¯ï¼Œä¸æ¶‰åŠå•†ç”¨ï¼Œä»…ä¾›å­¦ä¹ å’Œå‚è€ƒã€‚è¯·å°Šé‡ä¿¡æ¯ã€å°Šé‡å¼€å‘è€…ã€å‹¿åœ¨å•†ä¸šæ¨¡å¼ä¸‹ä¼ æ’­ã€‚

# HelloWorld

[å®‰è£…golang](https://go.dev/doc/install)

```go
package main

import "fmt"

func main() {
	fmt.Println("Hello, world")
	fmt.Println("Hello, ä¸–ç•Œ")
}
```

å®Œæˆå¹¶è¿è¡Œä¸Šé¢ä»£ç ï¼Œä½ ç°åœ¨å·²ç»æ˜¯ä¸€ä¸ªgolangç¨‹åºå‘˜ ( `gopher` ) äº†

- ç¨‹åºä» `main` åŒ…çš„ `main` å‡½æ•°å¼€å§‹è¿è¡Œã€‚
- å‡½æ•°ä½“å¤–æ¯ä¸ªè¯­å¥åº”è¯¥ä»¥å…³é”®å­—å¼€å§‹ï¼Œå¦‚ï¼š`var`ã€`func`ã€`type`ã€`const`ã€`import`ã€`package`
- å…³äºrunèƒŒåçš„æµç¨‹ï¼Œå­¦ä¹ åŸç†æ—¶å†æŒæ¡

:beers:æ‰¬å¸†èµ·èˆª

# å°åˆ€å¼‘ç‰›

[å®˜æ–¹å…¥é—¨åœ°å€](https://tour.go-zh.org/welcome/1)

> å…¥é—¨é‡è¦é€”å¾„ï¼Œåˆ‡å‹¿å¿ƒæ€¥ï¼Œå»ºè®®æ‰‹æ•²ä¸€é
>
> å¦‚æœä½ æ˜¯æ²¡æœ‰å…¶ä»–è¯­è¨€åŸºç¡€çš„åˆå­¦è€…ï¼Œå»ºè®®å­¦ä¹ 2-3éã€‚

# package - åŒ…

## åŒ…å£°æ˜

ä½¿ç”¨packageå…³é”®å­—å®šä¹‰åŒ…ï¼ŒåŒ…ç”±åŒä¸€ç›®å½•ä¸‹çš„å¤šä¸ªæºæ–‡ä»¶æ„æˆã€‚ç³»ç»Ÿè®¾è®¡åŒ…çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†ç®€åŒ–å¤§å‹ç¨‹åºçš„è®¾è®¡å’Œç»´æŠ¤å·¥ä½œã€‚

å°½å¯èƒ½è®©å‘½åæœ‰æè¿°æ€§ä¸”æ— æ­§ä¹‰ã€‚

åŒ…åä¸€èˆ¬é‡‡ç”¨å•æ•°çš„å½¢å¼ã€‚æ ‡å‡†åº“çš„bytesã€errorså’Œstringsä½¿ç”¨äº†å¤æ•°å½¢å¼åªæ˜¯ä¸ºäº†é˜²æ­¢å’Œå…³é”®å­—å†²çªã€‚

åŒ…ååŸåˆ™ä¸Šåªç”±å°å†™å­—é¢å’Œæ•°å­—ç»„æˆã€‚ä¸åŒ…å«å¤§å†™å­—æ¯å’Œä¸‹åˆ’çº¿ç­‰å­—ç¬¦ï¼ˆæµ‹è¯•åŒ…é™¤å¤–ï¼‰ã€‚

```go
package zip
package sha256
package sha256_test
```

åŒ…åé€šå¸¸ä¸ç›®å½•åä¸€è‡´

```go
// ç›®å½•åï¼šport-obj
// å¯¹åº”çš„åŒ…åï¼športobj
package portobj
```

## å¯¼å‡ºç¬¦å·

åŒ…æ˜¯æˆå‘˜ä½œç”¨åŸŸè¾¹ç•Œï¼ŒåŒ…å†…æˆå‘˜å¯ç›¸äº’è®¿é—®ã€‚ åç§°é¦–å­—æ¯å¤§å†™ä¸º å¯¼å‡ºæˆå‘˜ï¼ˆexportedï¼‰ï¼Œå¯å¤–éƒ¨è®¿é—®ã€‚

æ­¤è§„åˆ™é€‚ç”¨äºå…¨å±€å˜é‡ã€å…¨å±€å¸¸é‡ã€å‡½æ•°ã€ç±»å‹ã€å­—æ®µå’Œæ–¹æ³•ç­‰ã€‚

```go
package stonebird

var name = "stone bird"
var Total = 10  // ç¦æ­¢å¯¼å‡ºå…¨å±€å˜é‡

func GetName() string {
    return name
}
```

> æˆå‘˜å‘½åï¼Œé¿å…ä½¿ç”¨åŒ…åä¸ºå‰ç¼€
>
> éµå¾ªåŒ…å†…ä¿®æ”¹åŸåˆ™ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸å¯¼å‡ºå…¨å±€å˜é‡

## initå‡½æ•° - åˆå§‹åŒ–åŒ…

åŒ…å†…ä»»æ„ .go æ–‡ä»¶å†…éƒ½å¯å®šä¹‰ä¸€åˆ°å¤šä¸ª init åˆå§‹åŒ–å‡½æ•°ã€‚ åˆå§‹åŒ–å‡½æ•°ç”±ç¼–è¯‘å™¨ç”Ÿæˆä»£ç è‡ªåŠ¨æ‰§è¡Œï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œä¸èƒ½è¢«å…¶ä»–ä»£ç è°ƒç”¨ã€‚

```go
var x = 100

func init() {
	println("a", x) // a 100
}

func init() {
	println("b", x) // a 100
}
```

å¯ä»¥ä½¿ç”¨GODEBUGæŸ¥çœ‹åˆå§‹åŒ–æ‰§è¡Œæƒ…å†µ

```bash
GODEBUG=inittrace=1 ./test
init	internal/bytealg 	@0.008 ms, 	0.008 ms clock, 0 bytes, 0 allocs
init	runtime 			@0.040 ms, 	0.048 ms clock, 0 bytes, 0 allocs
init	main 				@0.31 ms,	0.014 ms clock, 0 bytes, 0 allocs
# 		åŒ…å 				   å¯åŠ¨æ—¶åˆ»     æ‰§è¡Œè€—æ—¶          å †å†…å­˜åˆ†é…æ•°é‡å’Œæ¬¡æ•°ã€‚
```

ä½¿ç”¨initå‡½æ•°åº”æ³¨æ„ï¼š

- é¿å…åœ¨initå‡½æ•°ä¸­è¿›è¡Œèµ„æºç”³è¯·ã€æ‰“å¼€æ–‡ä»¶ã€è¿æ¥æ•°æ®åº“ç­‰å¯èƒ½å¤±è´¥çš„æ“ä½œ
- ä¸€ä¸ªåŒ…ï¼ˆæˆ–ä¸€ä¸ªæ–‡ä»¶ï¼‰åªèƒ½æœ‰initå‡½æ•°ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªï¼Œinitå‡½æ•°ä¸èƒ½ç›¸äº’æœ‰ä¾èµ–ã€‚

## å†…éƒ¨åŒ…

å†…éƒ¨åŒ…çš„è§„èŒƒçº¦å®šï¼šå¯¼å‡ºè·¯å¾„åŒ…å«`internal`å…³é”®å­—çš„åŒ…ï¼Œåªå…è®¸`internal`çš„çˆ¶çº§ç›®å½•åŠçˆ¶çº§ç›®å½•çš„å­åŒ…å¯¼å…¥ï¼Œå…¶å®ƒåŒ…æ— æ³•å¯¼å…¥ã€‚

```bash
.
|-- checker
|   |-- internal
|   |   |-- cpu
|   |   |   `-- cpu.go
|   |   `-- ram
|   |       `-- ram.go
|   `-- server.go
|-- go.mod
|-- go.sum
`-- main.go
```

å¦‚ä¸ŠåŒ…ç»“æ„çš„ç¨‹åºï¼Œ`checker/internal/cpu`å’Œ`checker/internal/ram`åªèƒ½è¢«`checker`åŒ…åŠå…¶å­åŒ…ä¸­çš„ä»£ç å¯¼å…¥ï¼Œä¸èƒ½è¢«`main.go`å¯¼å…¥ã€‚

å†…éƒ¨åŒ…ï¼ˆinternal packageï¼‰æœºåˆ¶ç›¸å½“äºå¢åŠ äº†æ–°è®¿é—®æƒé™æ§åˆ¶ï¼š 

- å†…éƒ¨åŒ…ï¼ˆå«è‡ªèº«ï¼‰åªèƒ½è¢«å…¶çˆ¶ç›®å½•ï¼ˆå«æ‰€æœ‰å±‚æ¬¡å­ç›®å½•ï¼‰è®¿é—®ã€‚
- å†…éƒ¨åŒ…ç§æœ‰æˆå‘˜ï¼Œä¾ç„¶åªèƒ½åœ¨è‡ªå·±åŒ…å†…è®¿é—®ã€‚

## å¯¼å…¥åŒ…

æ¯ä¸ªåŒ…æ˜¯ç”±ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å­—ç¬¦ä¸²æ‰€æ ‡è¯†çš„å¯¼å…¥è·¯å¾„å®šä½ã€‚ä½¿ç”¨åŒ…å‰ï¼Œå¿…é¡»ä½¿ç”¨importè¯­å¥å¯¼å…¥è·¯å¾„ã€‚

```go
import (
    "fmt"
    "math/rand"
    "encoding/json"

    "golang.org/x/net/html"

    "github.com/go-sql-driver/mysql"
)
```

ä½¿ç”¨åˆ«åè§£å†³åŒ…å†²çª

```go
import (
	md "math/rand"
    m2d "math2/rand"
)
```

ç®€ä¾¿æ–¹å¼

```go
import (
	. "math/rand" // ä½¿ç”¨ç®€ä¾¿æ–¹å¼ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…å†…çš„å¯¼å‡ºç¬¦ï¼Œå·¥ä½œä¸­ç¦æ­¢ä½¿ç”¨
)
```

åªåˆå§‹åŒ–åŒ…ï¼Œåªæ‰§è¡Œinitå‡½æ•°

```go
import (
	_ "math/rand" // åªæ‰§è¡Œinitå‡½æ•°
)
```

å¯¼å…¥åŒ…è¯´æ˜ï¼š

- ä¸èƒ½ç›´æ¥æˆ–é—´æ¥å¯¼å…¥è‡ªå·±ï¼Œä¸æ”¯æŒä»»ä½•å½¢å¼çš„å¾ªç¯å¯¼å…¥ã€‚ä¸èƒ½å½¢æˆå¯¼å…¥æ¢ï¼ˆA->Bï¼ŒB->Cï¼ŒC->Aï¼‰
- æœªä½¿ç”¨çš„å¯¼å…¥ï¼ˆä¸åŒ…æ‹¬åˆå§‹åŒ–æ–¹å¼ï¼‰è¢«ç¼–è¯‘å™¨è§†ä¸ºé”™è¯¯ã€‚
- ç¦æ­¢ä½¿ç”¨ `.` æ¥ç®€åŒ–å¯¼å…¥åŒ…

## module - æ¨¡å—

æ¨¡å—ï¼ˆmoduleï¼‰æ˜¯åŒ…ï¼ˆpackagesï¼‰å’Œå…¶ä¾èµ–é¡¹ï¼ˆdependencyï¼‰çš„é›†åˆã€‚ ç›´æ¥ä½“ç°æ˜¯ go.mod æ–‡ä»¶ï¼Œå­˜å‚¨äº†æ¨¡å—è·¯å¾„ã€ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼Œä»¥åŠä¾èµ–é¡¹åˆ—è¡¨ã€‚

åˆå§‹åŒ–æ¨¡å—

```bash
go mod init github.com/stonebirdjx/test
```

go.modå†…å®¹

```go
module github.com/stonebirdjx/test // æ¨¡å—è·¯å¾„

go 1.18 // ç¼–è¯‘å™¨æœ€ä½ç‰ˆæœ¬å·

require (
	github.com/gin-contrib/pprof v1.3.0
	github.com/gin-gonic/gin v1.8.1
	github.com/go-sql-driver/mysql v1.6.0
	github.com/google/uuid v1.3.0
)
```

go getæ·»åŠ ã€ä¸‹è½½ï¼ˆæ›´æ–°ï¼‰ä¾èµ–é¡¹ï¼Œå¯ä»¥å‘ go.mod ã€ go.sum æ·»åŠ ä¾èµ–é¡¹å’ŒéªŒè¯ä¿¡æ¯ã€‚

```bash
go get . # åˆ†ææºç ï¼Œæ·»åŠ æ‰€æœ‰ä¾èµ–ã€‚
go get -u example.com/test # æŒ‡å®šæ¨¡å—ï¼Œä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚
go get -u=patch example.com/test@v1.3.4 # æŒ‡å®šç‰ˆæœ¬å·ã€‚
go get example.com/test@lastet # æœ€æ–°ç‰ˆæœ¬ã€‚
go get example.com/test@4cf76c2 # ä¼ªç‰ˆæœ¬å·ï¼ˆcommit hashï¼‰
go get example.com/test@bufix # åˆ†æ”¯ï¼ˆbranchï¼‰
# å¯ä½¿ç”¨ > ã€ >= ã€ < ã€ <= æ“ä½œç¬¦æŒ‡å®šç‰ˆæœ¬æŸ¥è¯¢èŒƒå›´ï¼ˆmodule queryï¼‰ã€‚
go get example.com/test@>v1.3.4
```

go mod ç®¡ç†æ¨¡å—ã€‚

- go mod init : åˆå§‹åŒ–æ¨¡å—ï¼Œåˆ›å»º go.mod æ–‡ä»¶ã€‚ 
- go mod tidy : æ·»åŠ é—æ¼ï¼Œç§»é™¤ä¸éœ€è¦çš„ä¾èµ–é¡¹ã€‚ 
- go mod edit : å‘½ä»¤è¡Œæ–¹å¼ç¼–è¾‘æ¨¡å—è®¾ç½®ã€‚
  - -require , -droprequire ï¼šæ·»åŠ ç›´æ¥æˆ–é—´æ¥ä¾èµ–é¡¹ã€‚ 
  - -replace , -dropreplace ï¼šæ›¿æ¢æ¨¡å—è·¯å¾„æˆ–ç‰ˆæœ¬ã€‚ 

```go
go mod edit -require example.com/test@v1.3.4
```

go mod ç‰ˆæœ¬æ ‡è¯†ï¼Œä»¥ v å¼€å¤´ï¼Œç„¶åæ˜¯è¯­ä¹‰ç‰ˆæœ¬ï¼ˆsemantic versionï¼‰ã€‚

æ­£å¼å‘å¸ƒå‰çš„é¢„å‘è¡Œç‰ˆæœ¬ï¼Œæ·»åŠ  -pre åç¼€ã€‚ 

ä½¿ç”¨ git tag ä¹‹ç±»çš„åŠŸèƒ½æ ‡è®°è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ã€‚ 

å¦‚æ²¡æœ‰æ ‡è®°ï¼Œåˆ™ä½¿ç”¨æäº¤ï¼ˆcommitï¼‰ä¿¡æ¯ï¼ˆtime, identï¼‰æ„æˆä¼ªç‰ˆæœ¬å·ã€‚

```bash
v(major).(minor).(patch)-(pre|beta)
 ä¸»è¦ æ¬¡è¦ è¡¥ä¸ é¢„å‘è¡Œæˆ–æµ‹è¯•ç‰ˆ
github.com/mattn/go-isatty v0.0.13  // indirect
github.com/mattn/go-isatty v0.0.13-pre // indirect
github.com/mattn/go-isatty v0.0.13-beta // indirect
github.com/modern-go/concurrent v0.0.0-20180228061459-e0a39a4cb421 // indirect
```

æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬

```go
go list -m -versions github.com/shirou/gopsutil
go list -m -versions all
```

moduleè¯´æ˜ï¼š

- å¦‚æœå­ç›®å½•æœ‰go.modæ–‡ä»¶ï¼Œé‚£ä¹ˆå­ç›®å½•å±äºç‹¬ç«‹æ¨¡å—ï¼Œä¸å±äºå½“å‰æ¨¡å—
- ä½¿ç”¨å‘½ä»¤ go get æ·»åŠ ã€ä¸‹è½½ï¼ˆæ›´æ–°ï¼‰ä¾èµ–é¡¹ï¼Œå…¶ä»–æ“ä½œå¯ç”¨ go mod å®Œæˆã€‚
- ä½¿ç”¨ go clean -modcache æ¸…é™¤ç¼“å­˜ã€‚ï¼ˆè‡ªåŠ¨é‡æ–°ä¸‹è½½ï¼‰
- æ›´æ”¹go.modåï¼Œä½¿ç”¨go mod tidyæ›´æ–°ä¾èµ–

## go work - å·¥ä½œç©ºé—´

go work ä¸»è¦è§£å†³å¤šæ¨¡å—å¼€å‘é‡åˆ°çš„é—®é¢˜: æ¯”å¦‚ç¼–è¯‘æ—¶æ‰¾ä¸åˆ°æœªå‘å¸ƒçš„æ¨¡å—

go workåˆå§‹åŒ– go.work æ–‡ä»¶,æ”¯æŒgo work use, go work replace æŒ‡ä»¤

```bash
go work init

go work use ./module1 ./module2
```

go.workæ–‡ä»¶å†…å®¹

```bash
# cat go.work

go 1.18 

use (
	./module1
	./module2
)

# ./module1/go.mod
# ./module2/go.mod
```

ç¼–è¯‘æ—¶å¯ä»¥å…³é—­ GOPROXY ï¼Œé¿å…åœ¨çº¿è·å–æ¨¡å—ä¿¡æ¯æ‹–æ…¢é€Ÿåº¦ã€‚

```go
GOPROXY=off go build 
```

## go vendor - æ‰“åŒ…ä¾èµ–æºç 

å°†ä¾èµ–åŒ…å¤åˆ¶åˆ° ./vendorç›®å½•

```go
go mod vendor
```

ç¦ç”¨å·¥ä½œç©ºé—´ï¼Œä»¥ ./vendorçš„æ–¹å¼ç¼–è¯‘

```go
go build -mod vendor
```

## åŒ…ç›¸å…³çš„ç¯å¢ƒå˜é‡

æ¨¡å—æ„ŸçŸ¥ï¼ˆmodule-awareï¼‰æ¨¡å¼ï¼Œç›¸å…³ç¯å¢ƒå˜é‡è¯´æ˜ã€‚ 

- GO111MODULE ï¼šæ¨¡å—æ„ŸçŸ¥æ¨¡å¼å¼€å…³ã€‚ï¼ˆé»˜è®¤ï¼šonï¼‰ 
- GOMODCACHE ï¼šæ¨¡å—ç¼“å­˜è·¯å¾„ã€‚ 
- GOPROXY ï¼šæ¨¡å—ä»£ç†æœåŠ¡åˆ—è¡¨ã€‚ 
- GOSUMDB ï¼šæ¨¡å—æ•°æ®å®‰å…¨æ ¡éªŒæ•°æ®åº“ã€‚ 
- GOPRIVATE ï¼šç§æœ‰æ¨¡å—è·¯å¾„ï¼Œç»•è¿‡ GOPROXY ç›´æ¥è·å–ã€‚ 

> GOPRIVATE æ˜¯ GONOPROXY ã€ GONOSUMDB çš„é»˜è®¤å€¼ã€‚

## :point_right:åŒ…æ€»ç»“

- åŒ…åé€šå¸¸ä¸ç›®å½•åä¸€è‡´ï¼Œæ³¨æ„å‘½åæ ¼å¼å’Œè§„èŒƒã€‚
- ç‰¹æ®Šå«ä¹‰çš„åŒ…åï¼š`main` ç”¨æˆ·å¯æ‰§è¡Œæ–‡ä»¶å…¥å£åŒ… ï¼› `all` æ‰€æœ‰åŒ…ï¼ŒåŒ…æ‹¬æ ‡å‡†åº“å’Œä¾èµ–é¡¹ã€‚`std` æ ‡å‡†åº“ã€‚ `cmd` å·¥å…·é“¾ã€‚å¯ä½¿ç”¨`go list`æŸ¥çœ‹æ‰€æœ‰çš„åŒ…ï¼Œ
- ä¸€èˆ¬æƒ…å†µä¸‹ç¦æ­¢å¯¼å‡ºå…¨å±€å˜é‡ã€‚å¦‚éœ€ä½¿ç”¨åŒ…çš„å…¨å±€å˜é‡ **éå¯¼å‡ºç¬¦å·+å¯¼å‡ºå‡½æ•°çš„å½¢å¼ã€‚**
- åŒ…å†…æˆå‘˜å‘½ååº”é¿å…ä½¿ç”¨åŒ…åä½œä¸ºå‰ç¼€ã€‚å¦‚`stream.StreamBuffer ` ä¼šæ˜¾å¾—å¾ˆç´¯èµ˜ã€‚
- é¿å…ä½¿ç”¨initå‡½æ•°ã€‚
- æ³¨æ„åŒ…ä¾èµ–å…³ç³»ï¼Œç¦æ­¢ä½¿ç”¨ `.` æ¥ç®€åŒ–å¯¼å…¥åŒ…ã€‚
- ä½¿ç”¨`go list  -m -versions` æ¥æŸ¥çœ‹æ‰€æœ‰åŒ…çš„ç‰ˆæœ¬
- å…³é—­GOPROXYï¼Œå¯ä»¥é¿å…åœ¨çº¿è·å–æ¨¡å—
- æºæ–‡ä»¶å¿…é¡»æ˜¯ `utf-8` çš„æ ¼å¼ã€‚

# ğŸ‘‰å„ç§ç±»å‹çš„å†…å­˜é•¿åº¦å’Œé›¶å€¼

| ç±»å‹          | å†…å­˜é•¿åº¦ | é›¶å€¼           | è¯´æ˜                                                       |
| ------------- | -------- | -------------- | ---------------------------------------------------------- |
| bool          | 1        | false          |                                                            |
| byte          | 1        | 0              | å¯¹åº”uint8                                                  |
| rune          | 4        | 0              | å¯¹åº”int32                                                  |
| intï¼Œuint     | 4æˆ–8     | 0              | 32ä½å†…å­˜é•¿åº¦ä¸º4ï¼Œå¯¹åº”int32ã€‚64ä½ç³»ç»Ÿå†…å­˜é•¿åº¦ä¸º8ï¼Œå¯¹åº”int64 |
| int8ã€uint8   | 1        | 0              | å–å€¼èŒƒå›´ï¼š-128-127, 0~255                                  |
| int16ã€uint16 | 2        | 0              | å–å€¼èŒƒå›´ï¼š-32768 ~ 32767, 0 ~ 65535                        |
| int32ã€uint32 | 4        | 0              | å–å€¼èŒƒå›´ï¼š-(2^31) ~ (2^31) - 1 ï¼Œ 0 ~ (2^32) - 1           |
| int64ã€uint64 | 8        | 0              | å–å€¼èŒƒå›´ï¼š-(2^63) ~ (2^63) - 1ï¼Œ 0 ~ (2^64) - 1            |
| float32       | 4        | 0              | æµ®ç‚¹æ•°                                                     |
| float64       | 8        | 0              | æµ®ç‚¹æ•°                                                     |
| complex64     | 8        | (0+0i)         | å¤æ•°                                                       |
| complex128    | 16       | (0+0i)         | å¤æ•°                                                       |
| uintptr       | 4æˆ–8     | 0              | å­˜å‚¨æŒ‡é’ˆçš„ uint32 æˆ– uint64 æ•´æ•°                           |
| array         |          | å€¼ç±»å‹çš„é»˜è®¤å€¼ | å€¼ç±»å‹çš„é»˜è®¤å€¼                                             |
| struct        |          | å€¼ç±»å‹çš„é»˜è®¤å€¼ | å€¼ç±»å‹çš„é»˜è®¤å€¼                                             |
| string        |          | ""             | utf-8å­—ç¬¦ä¸²                                                |
| slice         |          | nil            | å¼•ç”¨ç±»å‹                                                   |
| map           |          | nil            | å¼•ç”¨ç±»å‹                                                   |
| channel       |          | nil            | å¼•ç”¨ç±»å‹                                                   |
| interface     |          | nil            | æ¥å£                                                       |
| function      |          | nil            | å‡½æ•°                                                       |

golangç±»å‹ä¸»è¦åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚å€¼ç±»å‹æ˜¯æŒ‡å˜é‡ç›´æ¥å­˜å‚¨å€¼ã€‚å¼•ç”¨ç±»å‹æ˜¯æŒ‡å˜é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œæœ‰åœ°å€å»è®¿é—®çœŸæ­£å­˜å‚¨çš„å€¼ã€‚

å€¼ç±»å‹ï¼š int ã€float ã€boolã€stringï¼Œæ•°ç»„ï¼Œç»“æ„ä½“ã€‚

å¼•ç”¨ç±»å‹ï¼šmapï¼Œsliceï¼Œchannelï¼Œfuncï¼Œinterfaceã€æŒ‡é’ˆã€‚

**é»˜è®¤å€¼ï¼ˆé›¶å€¼ï¼‰è¯´æ˜**

- æ•°å­—ç±»å‹ `intã€uintã€float32 ã€float64` çš„é›¶å€¼ä¸º 0
- å¸ƒå°”ç±»å‹ `bool` çš„é›¶å€¼ä¸º`false`
- å­—ç¬¦ä¸² `string` çš„é›¶å€¼ä¸º `""`
- æ•°ç»„(array)å’Œç»“æ„ä½“é›¶å€¼ä¸ºå…ƒç´ çš„å€¼ç±»å‹
- å…¶ä»–å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆã€åˆ‡ç‰‡ã€æ˜ å°„ã€é€šé“ã€å‡½æ•°å’Œæ¥å£ï¼‰çš„é›¶å€¼åˆ™æ˜¯ nil

> å†…å­˜é•¿åº¦ç›®å‰äº†è§£å³å¯ï¼Œåœ¨ç»“æ„ä½“å†…å­˜å¯¹é½æ—¶å¯ä»¥è¯¦ç»†äº†è§£

# ğŸ‘‰ä½œç”¨åŸŸï¼ˆç§»åŠ¨ä½ç½®ï¼‰

ä½œç”¨åŸŸæŒ‡çš„æ˜¯ å®šä¹‰çš„å†…å®¹ï¼ˆå˜é‡ã€ç»“æ„ä½“...ï¼‰å¯ä»¥æœ‰æ•ˆä½¿ç”¨èŒƒå›´ã€‚è¯­æ³•å—ï¼ˆblockï¼‰å¥æ³•å—æ˜¯ç”± `{}`æ‰€åŒ…å«çš„ä¸€ç³»åˆ—è¯­å¥ï¼Œçˆ¶çº§ `{}` ä¸­å®šä¹‰çš„å†…å®¹å¯ä»¥åœ¨å­çº§ `{}` ä¸­è¢«è®¿é—®ï¼Œåä¹‹åˆ™ä¸èƒ½ã€‚

```
var a = "stone"

func block() {
	fmt.Println(a) // stone
	b := "bird"
	{
		fmt.Println(b) // bird
		c := "block content"
	}
	fmt.Println(c) // cä¸èƒ½è¢«å¤–å±‚å–åˆ°ã€‚Unused variable 'c'
}
```

**ä½œç”¨åŸŸè¯´æ˜**

- ä½¿ç”¨æ—¶æ‰ç”³è¯·ï¼Œä¿è¯ä½œç”¨åŸŸå°½é‡çš„å°ï¼Œä½œç”¨åŸŸè¶Šå°è¶Šå®‰å…¨ã€‚
- æœ‰gotoçš„åœºæ™¯è¦ä¿è¯è·³è½¬åå€¼æœ‰æ•ˆæ€§

# å˜é‡

## å˜é‡å£°æ˜

ä½¿ç”¨varå…³é”®å­—å®šä¹‰å˜é‡ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å®šä¹‰å¤šä¸ªå˜é‡

é›¶å€¼åˆå§‹åŒ–æœºåˆ¶å¯ä»¥ç¡®ä¿æ¯ä¸ªå£°æ˜çš„å˜é‡æ€»æ˜¯æœ‰ä¸€ä¸ªè‰¯å¥½å®šä¹‰çš„å€¼ï¼Œå› æ­¤åœ¨Goè¯­è¨€ä¸­ä¸å­˜åœ¨æœªåˆå§‹åŒ–çš„å˜é‡ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥ç®€åŒ–å¾ˆå¤šä»£ç ï¼Œè€Œä¸”å¯ä»¥åœ¨æ²¡æœ‰å¢åŠ é¢å¤–å·¥ä½œçš„å‰æä¸‹ç¡®ä¿è¾¹ç•Œæ¡ä»¶ä¸‹çš„åˆç†è¡Œä¸ºã€‚

```go
var s string   // ""
var i, j, k int // 0, 0, 0
var (
    a int // 0
    b float32 // 0
)
```

ç±»å‹ç”±åˆå§‹åŒ–è¡¨è¾¾å¼æ¨å¯¼, å¦‚æœæä¾›åˆå§‹åŒ–å€¼ï¼Œå¯çœç•¥å˜é‡ç±»å‹ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­ã€‚

```go
var b, f, s = true, 2.3, "four" // bool, float64, string
var boiling float64 = 100 
```

## ç®€çŸ­å˜é‡å£°æ˜

**åœ¨å‡½æ•°å†…éƒ¨**ï¼Œæœ‰ä¸€ç§ç§°ä¸ºç®€çŸ­å˜é‡å£°æ˜è¯­å¥çš„å½¢å¼å¯ç”¨äºå£°æ˜å’Œåˆå§‹åŒ–å±€éƒ¨å˜é‡ã€‚å®ƒä»¥`name := è¡¨è¾¾å¼ `å½¢å¼å£°æ˜å˜é‡ï¼Œå˜é‡çš„ç±»å‹æ ¹æ®è¡¨è¾¾å¼æ¥è‡ªåŠ¨æ¨å¯¼ã€‚

```go
func main() {
    n, s := 0x1234, "Hello, World!"
    x, _, z := something()
    in, err := os.Open(infile) // æœªä½¿ç”¨çš„å±€éƒ¨å˜é‡ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™
    println(x, s, n)
}
```

## :point_right:å˜é‡æ€»ç»“

- ä½¿ç”¨`:=` è¯­æ³•ç³–ç²¾ç®€èµ‹å€¼ï¼Œåªèƒ½åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œç²¾ç®€å®šä¹‰ä¼šé‡æ–°èµ‹å€¼å˜é‡ï¼ˆåœ°å€ä¸åŒï¼‰ã€‚
- ç‰¹æ®Šåªå†™å˜é‡ `_` ,ç”¨äºå¿½ç•¥å€¼ï¼Œèµ·å ä½ä½œç”¨ã€‚
- å¦‚æœå±€éƒ¨å˜é‡æœªä½¿ç”¨ç¼–è¯‘æœŸä¼šæŠ¥é”™ã€‚å…¨å±€å˜é‡æœªä½¿ç”¨ä¸ä¼šæŠ¥é”™ã€‚
- ç¦æ­¢å¯¼å‡ºå…¨å±€å˜é‡ï¼ˆåªèƒ½å°å†™ï¼‰ï¼Œå…¨å±€å˜é‡åªèƒ½ç”±æœ¬åŒ…ä¿®æ”¹ã€‚

# å¸¸é‡å’Œiota

## å¸¸é‡å®šä¹‰

ä½¿ç”¨constå…³é”®å­—å®šä¹‰å¸¸é‡

å¸¸é‡å€¼å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¯ç¡®å®šçš„æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼Œè¿˜å¯ä»¥æ˜¯ lenã€capã€unsafe.Sizeof ç­‰ç¼–è¯‘æœŸå¯ç¡®å®šç»“æœçš„å‡½æ•°è¿”å›å€¼ã€‚

```go
// å¤šå¸¸é‡åˆå§‹åŒ–
const x, y int = 1, 2
const pi = 3.14159

// ç±»å‹æ¨æ–­
const s = "Hello, World!"
const b = false

const (
	l  = "stonebird"
	ll = len(l)
	ls = unsafe.Sizeof(l)
)
```

åœ¨å¸¸é‡ç»„ä¸­ï¼Œå¦‚ä¸æä¾›ç±»å‹å’Œåˆå§‹åŒ–å€¼ï¼Œé‚£ä¹ˆè§†ä½œä¸ä¸Šä¸€å¸¸é‡ç›¸åŒã€‚

```go
const (
	s = "abc"
	x        // x = "abc"
)

const (
    a = 1
    b // 1
    c = 2
    d // 2
)
```

## iota

å…³é”®å­— iota å®šä¹‰å¸¸é‡ç»„ä¸­ä» 0 å¼€å§‹æŒ‰è¡Œè®¡æ•°çš„è‡ªå¢æšä¸¾å€¼ï¼Œç®€å•çš„è¯´iotaæ˜¯constå¸¸é‡ç»„çš„ç´¢å¼•ï¼Œåœ¨nè¡Œï¼Œå€¼ä¸ºn-1ã€‚

```go
const (
	Sunday    = iota // 0
	Monday           // 1ï¼Œé€šå¸¸çœç•¥åç»­â¾è¡¨è¾¾å¼ã€‚
	Tuesday          // 2
	Wednesday        // 3
	Thursday         // 4
	Friday           // 5
	Saturday         // 6
)

const (
	_        = iota             // iota = 0
	KB int64 = 1 << (10 * iota) // iota = 1
	MB                          // ä¸ KB è¡¨è¾¾å¼ç›¸åŒï¼Œiota = 2
	GB
	TB
)
```

å¯ä»¥æä¾›å¤šä¸ª iotaï¼Œå®ƒä»¬å„è‡ªå¢é•¿

```go
const (
	A, B = iota, iota << 10 // 0, 0 << 10
	C, D                    // 1, 1 << 10
)
```

å¦‚æœiotaè‡ªå¢è¢«æ‰“æ–­ï¼Œåˆ™å¿…é¡»æ˜¾å¼æ¢å¤

```go
const (
	A = iota // 0
	B        // 1
	C = "c"  // c
	D        // cï¼Œä¸ä¸Šâ¼€â¾ç›¸åŒã€‚
	E = iota // 4ï¼Œæ˜¾å¼æ¢å¤ã€‚æ³¨æ„è®¡æ•°åŒ…å«äº† Cã€D ä¸¤â¾ã€‚
	F        // 5
)
```

## :point_right:æ— ç±»å‹å¸¸é‡

é€šè¿‡å»¶è¿Ÿæ˜ç¡®å¸¸é‡çš„å…·ä½“ç±»å‹ï¼Œæ— ç±»å‹çš„å¸¸é‡ä¸ä»…å¯ä»¥æä¾›æ›´é«˜çš„è¿ç®—ç²¾åº¦ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥ç”¨äºæ›´å¤šçš„è¡¨è¾¾å¼è€Œä¸éœ€è¦æ˜¾å¼çš„ç±»å‹è½¬æ¢ã€‚

```go
const (
   E   = 2.71828182845904523536028747135266249775724709369995957496696763
   Pi  = 3.14159265358979323846264338327950288419716939937510582097494459
)
```

å¯¹äºå¸¸é‡é¢å€¼ï¼Œä¸åŒçš„å†™æ³•å¯èƒ½ä¼šå¯¹åº”ä¸åŒçš„ç±»å‹ã€‚ä¾‹å¦‚0ã€0.0ã€0iå’Œ`\u0000`è™½ç„¶æœ‰ç€ç›¸åŒçš„å¸¸é‡å€¼ï¼Œä½†æ˜¯å®ƒä»¬åˆ†åˆ«å¯¹åº”æ— ç±»å‹çš„æ•´æ•°ã€æ— ç±»å‹çš„æµ®ç‚¹æ•°ã€æ— ç±»å‹çš„å¤æ•°å’Œæ— ç±»å‹çš„å­—ç¬¦ç­‰ä¸åŒçš„å¸¸é‡ç±»å‹ã€‚åŒæ ·ï¼Œtrueå’Œfalseä¹Ÿæ˜¯æ— ç±»å‹çš„å¸ƒå°”ç±»å‹ï¼Œå­—ç¬¦ä¸²é¢å€¼å¸¸é‡æ˜¯æ— ç±»å‹çš„å­—ç¬¦ä¸²ç±»å‹ã€‚

ä¸åŒå†™æ³•çš„å¸¸é‡é™¤æ³•è¡¨è¾¾å¼å¯èƒ½å¯¹åº”ä¸åŒçš„ç»“æœï¼š

```go
var f float64 = 212
fmt.Println((f - 32) * 5 / 9)     // "100"; (f - 32) * 5 is a float64
fmt.Println(5 / 9 * (f - 32))     // "0";   5/9 is an untyped integer, 0
fmt.Println(5.0 / 9.0 * (f - 32)) // "100"; 5.0/9.0 is an untyped float
```

> å¹³æ—¶ä½¿ç”¨çš„æ•°å­—ã€nilã€trueã€falseã€"" éƒ½æ˜¯æ— ç±»å‹å¸¸é‡

## :point_right:å¸¸é‡æ€»ç»“

- å¸¸é‡æ˜¯ç¼–è¯‘æœŸå¯ç¡®å®šçš„å€¼ï¼Œæ‰€ä»¥æœ€å¥½ä¸ç”¨å‡½æ•°ï¼Œé™¤éå‡½æ•°å¯¹å¸¸é‡è®¡ç®—ï¼Œèƒ½è¿”å›å¯ç¡®å®šç»“æœã€‚
- iotaåœ¨å¸¸é‡ç»„ä¸­ç­‰åŒäºæ•°ç»„çš„ç´¢å¼•
- å¼€å‘è¿‡ç¨‹ä¸­å°½é‡ä¸è¦ä½¿ç”¨iota
- åªæœ‰å¸¸é‡å¯ä»¥æ˜¯æ— ç±»å‹çš„ã€‚å½“ä¸€ä¸ªæ— ç±»å‹çš„å¸¸é‡è¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œæ— ç±»å‹çš„å¸¸é‡å°†ä¼šè¢«éšå¼è½¬æ¢ä¸ºå¯¹åº”çš„ç±»å‹ï¼ˆå¦‚æœè½¬æ¢åˆæ³•çš„è¯ï¼‰ã€‚

# æ•°å­—ç±»å‹

## æ•´å‹

### æœ‰ç¬¦å·æ•´å‹ & æ— ç¬¦å·æ•´å‹

æœ‰ç¬¦å·æ•´å‹ï¼šint8ã€int16ã€int32å’Œint64ï¼Œåˆ†åˆ«å¯¹åº”8ã€16ã€32ã€64bitå¤§å°çš„æœ‰ç¬¦å·æ•´æ•°ã€‚

> int åœ¨32ä½è®¾å¤‡ä¸Šå¯¹åº”int32ï¼Œåœ¨64ä½èº«ä¸Šå¯¹åº”int64

æ— ç¬¦å·æ•´å‹ï¼šuint8ã€uint16ã€uint32å’Œuint64

>  uintåœ¨32ä½è®¾å¤‡ä¸Šå¯¹åº”uint32ï¼Œåœ¨64ä½èº«ä¸Šå¯¹åº”uint64

### è¿ç®—ç¬¦

ç…§ä¼˜å…ˆçº§é€’å‡çš„é¡ºåºæ’åˆ—

```go
*      /      %      <<       >>     &       &^
+      -      |      ^
==     !=     <      <=       >      >=
&&
||

// ä½è¿ç®—è¯´æ˜
&      ä½è¿ç®— AND
|      ä½è¿ç®— OR
^      ä½è¿ç®— XOR
&^     ä½æ¸…ç©ºï¼ˆAND NOTï¼‰
<<     å·¦ç§»
>>     å³ç§»
```

**è¿ç®—ç¬¦è¯´æ˜**

- æ²¡æœ‰ `~` å–åï¼Œå–åä¹Ÿç”¨ `^`
- åªæœ‰ `i++` æˆ–è€… `i--`ï¼Œ æ²¡æœ‰`++i`æˆ–è€…`--i`
- è¿ç®—è¿‡ç¨‹ä¸­ä¿è¯é™¤æ•°ä¸ä¸º0

> ä½æ“ä½œè¿ç®—ç¬¦`^`ä½œä¸ºäºŒå…ƒè¿ç®—ç¬¦æ—¶æ˜¯æŒ‰ä½å¼‚æˆ–ï¼ˆXORï¼‰ï¼Œå½“ç”¨ä½œä¸€å…ƒè¿ç®—ç¬¦æ—¶è¡¨ç¤ºæŒ‰ä½å–å

### æ•´æ•°å®‰å…¨

ä¸€ä¸ªç®—æœ¯è¿ç®—çš„ç»“æœï¼Œä¸ç®¡æ˜¯æœ‰ç¬¦å·æˆ–è€…æ˜¯æ— ç¬¦å·çš„ï¼Œå¦‚æœéœ€è¦æ›´å¤šçš„bitä½æ‰èƒ½æ­£ç¡®è¡¨ç¤ºçš„è¯ï¼Œå°±è¯´æ˜è®¡ç®—ç»“æœæ˜¯æº¢å‡ºäº†ã€‚

```go
var u uint8 = 255
fmt.Println(u, u+1, u*u) // "255 0 1"

var i int8 = 127
fmt.Println(i, i+1, i*i) // "127 -128 1"
```

ç¡®ä¿å‚ä¸ç§»ä½çš„æ“ä½œæ•°çš„ä½æ•°è¶³å¤Ÿ

```go
func foo(num uint16,bit uint8) bool {
	if uint32(num) > (uint32(1) << bit) { // å¼ºåˆ¶ç±»å‹è½¬æ¢åï¼Œåº”æ»¡è¶³å‡½æ•°è®¾è®¡è¦æ±‚
		return true
	}
	return false
}
```

ç¡®ä¿é™¤æ•°ä¸èƒ½ä¸º0

```go
func div(total,a int) bool {
	if a == 0 {
		return false
	}
	avg = total / a
}
```

ç¡®ä¿æ•´æ•°è½¬æ¢ä¸ä¼šé€ æˆæ•°æ®æˆªæ–­æˆ–è€…ç¬¦å·é”™è¯¯

```go
func int32216(a int32){
	if (a < math.MinInt16) || (a > math.MaxInt16) {
    	// é”™è¯¯å¤„ç†
	}
    int16(a)
}

func int2uint(a int32){
    if a < 0 {
    	// é”™è¯¯å¤„ç†
	}
    b := uint32(a)
}
```

### å…«è¿›åˆ¶

ä»»ä½•å¤§å°çš„æ•´æ•°å­—é¢å€¼éƒ½å¯ä»¥ç”¨ä»¥0å¼€å§‹çš„å…«è¿›åˆ¶æ ¼å¼ä¹¦å†™ï¼Œä¾‹å¦‚0666ï¼›å¦‚ä»Šå…«è¿›åˆ¶æ•°æ®é€šå¸¸ç”¨äºPOSIXæ“ä½œç³»ç»Ÿä¸Šçš„æ–‡ä»¶è®¿é—®æƒé™æ ‡å¿—

```go
md := 0666
md := 0644
```

### åå…­è¿›åˆ¶

ä»¥0xæˆ–0Xå¼€å¤´çš„åå…­è¿›åˆ¶æ ¼å¼ä¹¦å†™ï¼Œä¾‹å¦‚0xdeadbeefã€‚åå…­è¿›åˆ¶æ•°å­—å¯ä»¥ç”¨å¤§å†™æˆ–å°å†™å­—æ¯ã€‚åå…­è¿›åˆ¶æ•°å­—åˆ™æ›´å¼ºè°ƒæ•°å­—å€¼çš„bitä½æ¨¡å¼ã€‚

```go
x := 0xdeadbeef
```

### :point_right:æ•´å‹æ€»ç»“

- æ³¨æ„å„ç§æ•´å‹çš„å†…å­˜å¤§å°
- æ•´æ•°å®‰å…¨è¿ç®—
- å¯ä»¥ç”¨%dã€%oæˆ–%xå‚æ•°æ§åˆ¶è¾“å‡ºçš„è¿›åˆ¶æ ¼å¼

## æµ®ç‚¹æ•°

### æµ®ç‚¹æ•°ç±»å‹

æä¾›äº†ä¸¤ç§ç²¾åº¦çš„æµ®ç‚¹æ•°ï¼Œfloat32å’Œfloat64ã€‚

```go
var f float32 = 16777216 // 1 << 24
fmt.Println(f == f+1)    // "true"!
```

æµ®ç‚¹æ•°çš„å­—é¢å€¼å¯ä»¥ç›´æ¥å†™å°æ•°éƒ¨åˆ†

```go
const e = 2.71828 // (approximately)
```

å¾ˆå°æˆ–å¾ˆå¤§çš„æ•°æœ€å¥½ç”¨ç§‘å­¦è®¡æ•°æ³•ä¹¦å†™ï¼Œé€šè¿‡eæˆ–Eæ¥æŒ‡å®šæŒ‡æ•°éƒ¨åˆ†ï¼š

```go
const Avogadro = 6.02214129e23  // é˜¿ä¼ä¼½å¾·ç½—å¸¸æ•°
const Planck   = 6.62606957e-34 // æ™®æœ—å…‹å¸¸æ•°
```

### æ­£æ— ç©·å¤§ã€è´Ÿæ— ç©·å¤§å’Œéæ•°

æ­£æ— ç©·å¤§å’Œè´Ÿæ— ç©·å¤§ï¼Œåˆ†åˆ«ç”¨äºè¡¨ç¤ºå¤ªå¤§æº¢å‡ºçš„æ•°å­—å’Œé™¤é›¶çš„ç»“æœï¼Œè¿˜æœ‰NaNéæ•°ï¼Œä¸€èˆ¬ç”¨äºè¡¨ç¤ºæ— æ•ˆçš„é™¤æ³•æ“ä½œç»“æœ0/0æˆ–Sqrt(-1).

```go
var z float64
fmt.Println(z, -z, 1/z, -1/z, z/z) // "0 -0 +Inf -Inf NaN"
```

ä¸èƒ½æ¯”è¾ƒéæ•°nan

```go
nan := math.NaN()
fmt.Println(nan == nan, nan < nan, nan > nan) // "false false false"
```

### :point_right:æµ®ç‚¹æ•°æ€»ç»“

- æµ®ç‚¹æ•°å’Œæ•´å‹æ‹¥æœ‰ä¸€æ ·çš„è¿ç®—ç¬¦å’Œèƒ½åŠ›
- ä¸èƒ½æ¯”è¾ƒéæ•°nan
- ç¦æ­¢ä½¿ç”¨æµ®ç‚¹æ•°ä½œä¸ºå¾ªç¯çš„æ§åˆ¶å˜é‡
- ä½¿ç”¨%eï¼ˆå¸¦æŒ‡æ•°ï¼‰æˆ–%fçš„å½¢å¼æ‰“å°æµ®ç‚¹æ•°
- æµ®ç‚¹æ•°çš„ç›¸ç­‰æ¯”è¾ƒæ˜¯å±é™©çš„

## å¤æ•°

Goè¯­è¨€æä¾›äº†ä¸¤ç§ç²¾åº¦çš„å¤æ•°ç±»å‹ï¼šcomplex64å’Œcomplex128ï¼Œåˆ†åˆ«å¯¹åº”float32å’Œfloat64ä¸¤ç§æµ®ç‚¹æ•°ç²¾åº¦ã€‚å†…ç½®çš„complexå‡½æ•°ç”¨äºæ„å»ºå¤æ•°ï¼Œå†…å»ºçš„realå’Œimagå‡½æ•°åˆ†åˆ«è¿”å›å¤æ•°çš„å®éƒ¨å’Œè™šéƒ¨ï¼š

å¤æ•°è¿ç®— `i*i = -1`

åŠ æ³•ï¼š (a+bi)+(c+di)=(a+c)+(b+d)i

å‡æ³•ï¼š (a+bi)-(c+di)=(a-c)+(b-d)i

ä¹˜æ³•:	(a+bi)(c+di)=(ac-bd)+(bc+ad)i

é™¤æ³•ï¼šï¼ˆ7+i)/(3+4i)=((7+i)(3-4i))/((3+4i)(3-4i))

```go
var x complex128 = complex(1, 2) // 1+2i
var y complex128 = complex(3, 4) // 3+4i
fmt.Println(x*y)                 // "(-5+10i)"
fmt.Println(real(x*y))           // "-5"
fmt.Println(imag(x*y))           // "10"
```

ä»¥ `æ•´æ•°i` çš„æ–¹å¼å®šä¹‰å¤æ•°

```go
x := 1 + 2i
y := 3 + 4i
z := 1i * 1i
```

å¤æ•°ä¹Ÿå¯ä»¥ç”¨==å’Œ!=è¿›è¡Œç›¸ç­‰æ¯”è¾ƒã€‚åªæœ‰ä¸¤ä¸ªå¤æ•°çš„å®éƒ¨å’Œè™šéƒ¨éƒ½ç›¸ç­‰çš„æ—¶å€™å®ƒä»¬æ‰æ˜¯ç›¸ç­‰çš„

```go
fmt.Println(1 + 2i == 1 + 2i) 
```

**å¤æ•°è¯´æ˜**

- å’Œæµ®ç‚¹æ•°ä¸€æ ·ï¼Œæ¯”è¾ƒç›¸ç­‰æ—¶ç²¾åº¦é—®é¢˜å¾ˆå±é™©

## :point_right:å¸ƒå°”å‹

å¸ƒå°”ç±»å‹çš„å€¼åªæœ‰ä¸¤ç§ï¼štrueå’Œfalseã€‚ä¸€å…ƒæ“ä½œç¬¦`!`å¯¹åº”é€»è¾‘éæ“ä½œï¼Œå› æ­¤`!true`çš„å€¼ä¸º`false`

```go
!false // true
!!false // fasle
```

å°”å€¼å¯ä»¥å’Œ&&ï¼ˆANDï¼‰å’Œ||ï¼ˆORï¼‰æ“ä½œç¬¦ç»“åˆ

```go
if 'a' <= c && c <= 'z' ||
    'A' <= c && c <= 'Z' ||
    '0' <= c && c <= '9' {
    // ...ASCII letter or digit...
}
```

# å­—ç¬¦ä¸²

## ç»“æ„

å­—ç¬¦ä¸²æ˜¯ ä¸å¯å˜ å­—èŠ‚åºåˆ—ï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ªå¤åˆç»“æ„ã€‚å­—ç¬¦ä¸²å¯ä»¥åŒ…å«ä»»æ„çš„æ•°æ®

```go
type stringStruct struct {
	str unsafe.Pointer
	len int
}
```

ç´¢å¼•è®¿é—®å­—èŠ‚æ•°ç»„ï¼ˆéå­—ç¬¦ï¼‰ï¼Œä¸èƒ½è·å–å…ƒç´ åœ°å€

```go
s := "hello, world"
fmt.Println(len(s))     // "12"
fmt.Println(s[0], s[7]) // "104 119" ('h' and 'w')
fmt.Println(&s[3]) // éæ³•ï¼Œå­—ç¬¦ä¸²ä¸èƒ½è·å–å…ƒç´ åœ°å€
```

## åŸå§‹å­—ç¬¦ä¸²raw

åŸå§‹å­—ç¬¦ä¸²ï¼ˆraw stringï¼‰`` å®šä¹‰çš„å­—ç¬¦ä¸²ä¸åšè½¬ä¹‰å¤„ç†

```go
s := `stone
bird\n\t
`
fmt.Println(s)
// stone
// bird\n\t
```

## å­ä¸²å†…éƒ¨æŒ‡é’ˆä¾æ—§æŒ‡å‘åŸå­—èŠ‚æ•°ç»„

```go
func main() {
	s := "hello, world!"
	s2 := s[:4]
	p1 := (*reflect.StringHeader)(unsafe.Pointer(&s))
	p2 := (*reflect.StringHeader)(unsafe.Pointer(&s2))
	fmt.Printf("%#v, %#v\n", p1, p2)
}

// &StringHeader{ Data:0x497208, Len:13 }
// &StringHeader{ Data:0x497208, Len:4 }
```

## foréå†çš„ä¸¤ç§æ–¹å¼

ä½¿ç”¨forå¾ªç¯éå†å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿæœ‰ byte å’Œ rune ä¸¤ç§æ–¹å¼ã€‚

è¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¯å…ˆå°†å…¶è½¬æ¢æˆ[]rune æˆ– []byteï¼Œå®Œæˆåå†è½¬æ¢ä¸º stringã€‚æ— è®ºå“ªç§è½¬æ¢ï¼Œéƒ½ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼Œå¹¶å¤åˆ¶å­—èŠ‚æ•°ç»„ã€‚

```go
func main() {
	s := "abcef"
	for i := 0; i < len(s); i++ { // byte
		fmt.Printf("%c,", s[i])
	}
	fmt.Println()
	for _, r := range s { // rune
		fmt.Printf("%c,", r)
	}
}
```

å¯ä»¥ä½œä¸ºappendï¼Œå’Œcopyå‚æ•°

```go
func main() {
	s := "de"
	bs := make([]byte, 0)
	bs = append(bs, "abc"...)
	bs = append(bs, s...)
	buf := make([]byte, 5)
	copy(buf, "abc")
	copy(buf[3:], s)
	fmt.Printf("%s\n", bs) // abcde
	fmt.Printf("%s\n", buf)// abcde
}
```

## å­—ç¬¦ä¸²è½¬ä¹‰

```
\a      å“é“ƒ
\b      é€€æ ¼
\f      æ¢é¡µ
\n      æ¢è¡Œ
\r      å›è½¦
\t      åˆ¶è¡¨ç¬¦
\v      å‚ç›´åˆ¶è¡¨ç¬¦
\'      å•å¼•å·ï¼ˆåªç”¨åœ¨ '\'' å½¢å¼çš„runeç¬¦å·é¢å€¼ä¸­ï¼‰
\"      åŒå¼•å·ï¼ˆåªç”¨åœ¨ "..." å½¢å¼çš„å­—ç¬¦ä¸²é¢å€¼ä¸­ï¼‰
\\      åæ–œæ 
```

## Unicode

Unicodeæ”¶é›†äº†è¿™ä¸ªä¸–ç•Œä¸Šæ‰€æœ‰çš„ç¬¦å·ç³»ç»Ÿï¼ŒåŒ…æ‹¬é‡éŸ³ç¬¦å·å’Œå…¶å®ƒå˜éŸ³ç¬¦å·ï¼Œåˆ¶è¡¨ç¬¦å’Œå›è½¦ç¬¦ï¼Œè¿˜æœ‰å¾ˆå¤šç¥ç§˜çš„ç¬¦å·ï¼Œæ¯ä¸ªç¬¦å·éƒ½åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„Unicodeç ç‚¹ï¼ŒUnicodeç ç‚¹å¯¹åº”Goè¯­è¨€ä¸­çš„runeï¼ˆint32ï¼‰æ•´æ•°ç±»å‹ã€‚

## UTF-8

UTF8æ˜¯ä¸€ä¸ªå°†Unicodeç ç‚¹ç¼–ç ä¸ºå­—èŠ‚åºåˆ—çš„å˜é•¿ç¼–ç ã€‚æ˜¯Unicodeçš„æ ‡å‡†ã€‚UTF8ç¼–ç ä½¿ç”¨1åˆ°4ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºæ¯ä¸ªUnicodeç ç‚¹

```bash
0xxxxxxx                             runes 0-127    (ASCII)
110xxxxx 10xxxxxx                    128-2047       (values <128 unused)
1110xxxx 10xxxxxx 10xxxxxx           2048-65535     (values <2048 unused)
11110xxx 10xxxxxx 10xxxxxx 10xxxxxx  65536-0x10ffff (other values unused)
```

## :point_right:å­—ç¬¦ä¸²æ€»ç»“

- ç´¢å¼•è®¿é—®å­—èŠ‚æ•°ç»„ï¼ˆéå­—ç¬¦ï¼‰ï¼Œä¸èƒ½ç”¨ç´¢å¼•è·å–å­—èŠ‚å…ƒç´ æŒ‡é’ˆï¼Œ&s[i] éæ³•ã€‚ 
- åˆ‡ç‰‡è¿”å›å­ä¸²ï¼Œä¾æ—§æŒ‡å‘åŸæ•°ç»„ã€‚
- å†…ç½®å‡½æ•° len è¿”å›å­—èŠ‚æ•°ç»„é•¿åº¦ã€‚
- æ”¯æŒ != ã€ == ã€ < ã€ <= ã€ >= ã€ > ã€ + ã€ += 
- å­—ç¬¦ä¸²ä¸å¯è¢«ä¿®æ”¹ï¼Œæ¢æˆ[]rune æˆ– []byteä¿®æ”¹åæ¢å›å­—ç¬¦ä¸²ï¼Œåœ°å€ä¼šå˜ã€‚

> å­—ç¬¦ä¸²çš„å­˜å‚¨åœ¨åªè¯»æ®µä¸Šï¼Œå¹¶ä¸æ˜¯å †ä¸Šæˆ–è€…æ ˆä¸Š

# æ•°ç»„

æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„(éè´Ÿæ•°), èµ‹å€¼å’Œä¼ å‚ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆã€‚

```go
var a [4]int // å…ƒç´ è‡ªåŠ¨åˆå§‹åŒ–ä¸ºé›¶ã€‚

b := [4]int{2, 5} // æœªæä¾›åˆå§‹å€¼çš„å…ƒç´ è‡ªåŠ¨åˆå§‹åŒ–ä¸º 0ã€‚
c := [4]int{5, 3: 10} // å¯æŒ‡å®šç´¢å¼•ä½ç½®åˆå§‹åŒ–ã€‚
d := [...]int{1, 2, 3} // ç¼–è¯‘å™¨æŒ‰åˆå§‹åŒ–å€¼æ•°é‡ç¡®å®šæ•°ç»„é•¿åº¦ã€‚
/*
	a: [0 0 0 0]
	b: [2 5 0 0]
	c: [5 0 0 10]
	d: [1 2 3]
	
*/
a := [2][3]int{{1, 2, 3}, {4, 5, 6}}
```

## è¯­æ³•ç³–

```go
// ç¼–è¯‘å™¨æŒ‰åˆå§‹åŒ–å€¼æ•°é‡ç¡®å®šæ•°ç»„é•¿åº¦ã€‚
q := [...]int{1, 2, 3} 
fmt.Printf("%T\n", q) // "[3]int"
```

æ”¯æŒç´¢å¼•èµ‹å€¼åˆå§‹åŒ–ï¼Œæ²¡æœ‰åŒ…å«çš„ç´¢å¼•ä¸ºé»˜è®¤å€¼

```go
e := [...]int{10, 3: 100} // æ”¯æŒç´¢å¼•åˆå§‹åŒ–ï¼Œæ•°ç»„é•¿åº¦ä¸æ­¤æœ‰å…³ã€‚

// e: [10 0 0 100]
```

å¤šç»´æ•°ç»„ä¸èƒ½ä½¿ç”¨è¯­æ³•ç³– `...` å®šä¹‰, è¯­æ³•ç³–åªèƒ½ç”¨äºå¤–å±‚æ•°ç»„

```go
b := [...][2]int{{1, 1}, {2, 2}, {3, 3}} // ç¬¬ 2 çº¬åº¦ä¸èƒ½â½¤ "..."ã€‚ç¬¬äºŒç»´ï¼ˆå¤šç»´ï¼‰ä¸èƒ½ç”¨è¯­æ³•ç³–
```

å¤šç»´æ•°ç»„ä¾æ—§æ˜¯è¿ç»­å†…å­˜å­˜å‚¨

```go
func main() {
	x := [...][2]int{
		{1, 2},
		{3, 4},
	}

	y := [...][3][2]int{
		{
			{1, 2},
			{3, 4},
			{5, 6},
		},
		{
			{10, 11},
			{12, 13},
			{14, 15},
		},
	}

	fmt.Println(x, len(x), cap(x)) // 2, 2
	fmt.Println(y, len(y), cap(y)) // 2, 2
}

/*
(gdb) x/4xg &x
0xc000066df0: 0x0000000000000001 0x0000000000000002
0xc000066e00: 0x0000000000000003 0x0000000000000004
(gdb) x/12xg &y
0xc000066e30: 0x0000000000000001 0x0000000000000002
0xc000066e40: 0x0000000000000003 0x0000000000000004
0xc000066e50: 0x0000000000000005 0x0000000000000006
0xc000066e60: 0x000000000000000a 0x000000000000000b
0xc000066e70: 0x000000000000000c 0x000000000000000d
0xc000066e80: 0x000000000000000e 0x000000000000000f
*/
```

å–å€¼

```go
var a [10]int 
a[0:10]ã€a[:10]ã€a[0:]ã€a[:] // è¿™äº›æƒ…å†µç­‰ä»·
```

æ•°ç»„æ¯”è¾ƒï¼Œé•¿åº¦å’Œç±»å‹ç›¸åŒä¸”å…ƒç´ å¯æ¯”è¾ƒçš„æ•°ç»„å¯ä»¥æ¯”è¾ƒï¼Œ[2]int å’Œ [3]int æ˜¯ä¸åŒç±»å‹ã€‚

```go
a := [2]int{1, 2}
b := [...]int{1, 2}
c := [2]int{1, 3}
fmt.Println(a == b, a == c, b == c) // "true false false"
d := [3]int{1, 2}
fmt.Println(a == d) // compile error: cannot compare [2]int == [3]int
```

## :point_right:ç»„æ•°æ€»ç»“

- æ•°ç»„æ˜¯å•ä¸€å†…å­˜å—,å¹¶æ— å…¶ä»–é™„åŠ ç»“æ„
- æ”¯æŒç´¢å¼•èµ‹å€¼åˆå§‹åŒ–ï¼Œæ— ç´¢å¼•çš„éƒ¨åˆ†ä¸ºé»˜è®¤å€¼
- æ”¯æŒè·å–å…ƒç´ æŒ‡é’ˆï¼Œ&s[i]
- å†…ç½®å‡½æ•° len å’Œ cap éƒ½è¿”å›ä¸€ç»´é•¿åº¦
- å…ƒç´ ç±»å‹æ”¯æŒ == ã€ != ï¼Œé‚£ä¹ˆæ•°ç»„ä¹Ÿæ”¯æŒ
- æŒ‡é’ˆæ•°ç»„ [n]*Tï¼Œæ•°ç»„æŒ‡é’ˆ *[n]Tã€‚
- æ•°ç»„é€šè¿‡ä¸‹æ ‡å–å€¼å‰ï¼Œä¸ºå®‰å…¨éœ€åˆ¤æ–­æ•°ç»„çš„é•¿åº¦ã€‚

# Slice

Sliceï¼ˆåˆ‡ç‰‡ï¼‰ä»£è¡¨å˜é•¿çš„åºåˆ—ï¼Œåºåˆ—ä¸­æ¯ä¸ªå…ƒç´ éƒ½æœ‰ç›¸åŒçš„ç±»å‹ã€‚ä¸€ä¸ªsliceç±»å‹ä¸€èˆ¬å†™ä½œ[]Tï¼Œå…¶ä¸­Tä»£è¡¨sliceä¸­å…ƒç´ çš„ç±»å‹ï¼›sliceçš„è¯­æ³•å’Œæ•°ç»„å¾ˆåƒï¼Œåªæ˜¯æ²¡æœ‰å›ºå®šé•¿åº¦è€Œå·²ã€‚

## åº•å±‚æ•°æ®ç»“æ„

æºç åŒ… `src/runtime/slice.go`

```go
type slice struct {
    array unsafe.Pointer
    len   int
    cap   int
}
```

## appendå‡½æ•°

å†…ç½®çš„appendå‡½æ•°ç”¨äºå‘sliceè¿½åŠ å…ƒç´ 

```go
var runes []rune
for _, r := range "Hello, ä¸–ç•Œ" {
    runes = append(runes, r)
}
fmt.Printf("%q\n", runes) // "['H' 'e' 'l' 'l' 'o' ',' ' ' 'ä¸–' 'ç•Œ']"

var x []int
x = append(x, 1)
x = append(x, 2, 3)
x = append(x, 4, 5, 6)
x = append(x, x...) // append the slice x
fmt.Println(x)      // "[1 2 3 4 5 6 1 2 3 4 5 6]"
```

æ¯æ¬¡è°ƒç”¨appendå‡½æ•°ï¼Œå¿…é¡»å…ˆæ£€æµ‹sliceåº•å±‚æ•°ç»„æ˜¯å¦æœ‰è¶³å¤Ÿçš„å®¹é‡æ¥ä¿å­˜æ–°æ·»åŠ çš„å…ƒç´ ã€‚

å¦‚æœæœ‰è¶³å¤Ÿç©ºé—´çš„è¯ï¼Œç›´æ¥æ‰©å±•sliceï¼ˆä¾ç„¶åœ¨åŸæœ‰çš„åº•å±‚æ•°ç»„ä¹‹ä¸Šï¼‰ï¼Œå°†æ–°æ·»åŠ çš„yå…ƒç´ å¤åˆ¶åˆ°æ–°æ‰©å±•çš„ç©ºé—´ï¼Œå¹¶è¿”å›sliceã€‚

å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å¢é•¿ç©ºé—´çš„è¯ï¼Œappendå‡½æ•°åˆ™ä¼šå…ˆåˆ†é…ä¸€ä¸ªè¶³å¤Ÿå¤§çš„sliceç”¨äºä¿å­˜æ–°çš„ç»“æœï¼Œå…ˆå°†è¾“å…¥çš„xå¤åˆ¶åˆ°æ–°çš„ç©ºé—´ï¼Œç„¶åæ·»åŠ yå…ƒç´ ã€‚ç»“æœå’Œè¾“å…¥å°†æ˜¯ä¸åŒçš„åº•å±‚æ•°ç»„ã€‚

## copy

åœ¨ä¸¤ä¸ªåˆ‡ç‰‡é—´å¤åˆ¶æ•°æ®ï¼š 

- å…è®¸æŒ‡å‘åŒä¸€æ•°ç»„ã€‚ 
- å…è®¸ç›®æ ‡åŒºé—´é‡å ã€‚ 
- å¤åˆ¶é•¿åº¦ä»¥è¾ƒçŸ­ï¼ˆ len ï¼‰åˆ‡ç‰‡ä¸ºå‡†ã€‚

```go
func main() {
    s := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
    // åœ¨åŒä¸€åº•å±‚æ•°ç»„çš„ä¸åŒåŒºé—´å¤åˆ¶ã€‚
    src := s[5:8]
    dst := s[4:]
    n := copy(dst, src)
    fmt.Println(n, s)
    // åœ¨ä¸åŒæ•°ç»„é—´å¤åˆ¶ã€‚
    dst = make([]int, 6)
    n = copy(dst, src)
    fmt.Println(n, dst)
}
/*
3 [0 1 2 3 5 6 7 7 8 9]
3 [6 7 7 0 0 0]
*/
```

å¯ä»¥ç›´æ¥ä»å­—ç¬¦ä¸²å¤åˆ¶åˆ°[]byte

```go
func main() {
    b := make([]byte, 3)
    n := copy(b, "abcde")
    fmt.Println(n, b)
}
// 3 [97 98 99]
```

## sliceæ€»ç»“

- æœªåˆå§‹åŒ–ä¸º nil ã€‚

- åŸºäºæ•°ç»„ã€åˆå§‹åŒ–å€¼æˆ– make å‡½æ•°åˆ›å»ºã€‚ 

- å‡½æ•° len è¿”å›å…ƒç´ æ•°é‡ï¼Œ cap è¿”å›å®¹é‡ã€‚ 

- ä»…èƒ½åˆ¤æ–­æ˜¯å¦ä¸º nil ï¼Œä¸æ”¯æŒå…¶ä»– == ã€ != æ“ä½œã€‚

-  ä»¥ç´¢å¼•è®¿é—®å…ƒç´ ï¼Œå¯è·å–åº•å±‚æ•°ç»„å…ƒç´ æŒ‡é’ˆã€‚

-  åº•å±‚æ•°ç»„å¯èƒ½åœ¨å †ä¸Šåˆ†é…ã€‚
- åˆ†é…é¢„ç•™çš„ç©ºé—´å¯ä»¥æé«˜æ€§èƒ½

# map

å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å·§å¦™å¹¶ä¸”å®ç”¨çš„æ•°æ®ç»“æ„ã€‚å®ƒæ˜¯ä¸€ä¸ª**æ— åº**çš„key/valueå¯¹çš„é›†åˆï¼Œå…¶ä¸­æ‰€æœ‰çš„keyéƒ½æ˜¯ä¸åŒçš„ï¼Œç„¶åé€šè¿‡ç»™å®šçš„keyå¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å¤æ‚åº¦å†…æ£€ç´¢ã€æ›´æ–°æˆ–åˆ é™¤å¯¹åº”çš„valueã€‚

å†…ç½®çš„makeå‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªmapï¼š

```go
ages := make(map[string]int) // mapping from strings to ints

ages := map[string]int{
    "alice":   31,
    "charlie": 34,
}
```

è¦æƒ³éå†mapä¸­å…¨éƒ¨çš„key/valueå¯¹çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨rangeé£æ ¼çš„forå¾ªç¯å®ç°ï¼Œå’Œä¹‹å‰çš„sliceéå†è¯­æ³•ç±»ä¼¼ã€‚

```go
for name, age := range ages {
    fmt.Printf("%s\t%d\n", name, age)
}
```

## mapæ€»ç»“

- å¼•ç”¨ç±»å‹ï¼Œæ— åºé”®å€¼å¯¹é›†åˆã€‚ 
- ä»¥åˆå§‹åŒ–è¡¨è¾¾å¼æˆ– make å‡½æ•°åˆ›å»ºã€‚ 
- ä¸»é”®é¡»æ˜¯æ”¯æŒ == ã€ != çš„ç±»å‹ï¼ˆkeyå¿…é¡»ä¸ºå€¼ç±»å‹ï¼‰ã€‚ 
- å¯åˆ¤æ–­å­—å…¸æ˜¯å¦ä¸º nil ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ“ä½œã€‚ 
- å‡½æ•° len è¿”å›é”®å€¼å¯¹æ•°é‡ã€‚ 
- è®¿é—®ä¸å­˜åœ¨ä¸»é”®ï¼Œè¿”å›é›¶å€¼ã€‚ è¿­ä»£ä»¥éšæœºæ¬¡åºè¿”å›ã€‚
- å€¼ä¸å¯å¯»å€ï¼ˆnot addressableï¼‰ï¼Œéœ€æ•´ä½“èµ‹å€¼,æˆ–ä½¿ç”¨æŒ‡é’ˆã€‚ 
- æŒ‰éœ€æ‰©å¼ ï¼Œä½†ä¸ä¼šæ”¶ç¼©ï¼ˆshrinkï¼‰å†…å­˜ã€‚
- é¢„åˆ†é…è¶³å¤Ÿç©ºé—´æœ‰åŠ©äºæå‡æ€§èƒ½ï¼Œå‡å°‘å› æ‰©å¼ å¼•å‘çš„å†…å­˜åˆ†é…å’Œæ•°æ®è¿ç§»æ“ä½œ

# ç»“æ„ä½“

ç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œæ˜¯ä¸€ç§èšåˆçš„æ•°æ®ç±»å‹ï¼Œæ˜¯ç”±é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„ç±»å‹çš„å€¼èšåˆæˆçš„å®ä½“ã€‚æ¯ä¸ªå€¼ç§°ä¸ºç»“æ„ä½“çš„æˆå‘˜ã€‚

ç»“æ„ä½“èµ‹å€¼å’Œä¼ å‚ä¼šå¤åˆ¶å…¨éƒ¨å†…å®¹ã€‚å¯ç”¨"_" å®šä¹‰è¡¥ä½å­—æ®µï¼Œæ”¯æŒæŒ‡å‘è‡ªèº«ç±»å‹çš„æŒ‡é’ˆæˆå‘˜

```go
type node struct {
	id    int
	value string
	next  *node // è‡ªèº«æŒ‡é’ˆç±»å‹ã€‚
}
```

## åŒ¿åç»“æ„ä½“

```go
// åŒ¿åç»“æ„
user := struct {
		id   int
		name string
	}{
		id:   1,
		name: "user1",
	}
```

## ç»“æ„ä½“æ¯”è¾ƒ

æ‰€æœ‰æˆå‘˜ç±»å‹ç›¸åŒï¼Œé¡ºåºç›¸åŒï¼Œå¯æ¯”è¾ƒçš„å‰æä¸‹ç»“æ„ä½“æ‰å¯ä»¥æ¯”è¾ƒ`==` æˆ– `!=`

```go
func main() {
	// å­—æ®µåã€å­—æ®µç±»å‹ã€æ ‡ç­¾å’Œæ’åˆ—é¡ºåºéƒ½ç›¸åŒã€‚
	d1 := struct {
		x int
		s string
	}{100, "abc"}
	var d2 struct {
		x int
		s string
	}
	d2.x = 100
	d2.s = "abc"
	println(d1 == d2) // true
}
```

## ç©ºç»“æ„ä½“

ç©ºç»“æ„ï¼ˆ struct{} ï¼‰æ˜¯æŒ‡æ²¡æœ‰å­—æ®µçš„ç»“æ„ç±»å‹ï¼Œå¸¸ç”¨äºå€¼å¯è¢«å¿½ç•¥çš„åœºåˆï¼Œæ¯”å¦‚seté›†åˆï¼Œchannelæ¶ˆæ¯é€šçŸ¥ã€‚ 

æ— è®ºæ˜¯å…¶è‡ªèº«ï¼Œè¿˜æ˜¯ä½œä¸ºå…ƒç´ ç±»å‹ï¼Œå…¶é•¿åº¦éƒ½ä¸ºé›¶ï¼Œä½†è¿™ä¸å½±å“ä½œä¸ºå®ä½“å­˜åœ¨ã€‚

```go
func main() {
	var a struct{}
	var b [1000]struct{}
	s := b[:]
	println(unsafe.Sizeof(a), unsafe.Sizeof(b)) // 0, 0
	println(len(s), cap(s))                     // 1000, 1000
}
```

## Tag

æ ‡ç­¾ï¼ˆtagï¼‰ä¸æ˜¯æ³¨é‡Šï¼Œè€Œæ˜¯å¯¹å­—æ®µè¿›è¡Œæè¿°çš„å…ƒæ•°æ®ã€‚ ä¸æ˜¯æ•°æ®æˆå‘˜ï¼Œå´æ˜¯ç±»å‹çš„ç»„æˆéƒ¨åˆ†ã€‚ å†…å­˜å¸ƒå±€ç›¸åŒï¼Œå…è®¸æ˜¾å¼ç±»å‹è½¬æ¢ã€‚

è¿è¡ŒæœŸï¼Œå¯ç”¨åå°„ï¼ˆreflectï¼‰è·å–æ ‡ç­¾ä¿¡æ¯ã€‚å¸¸è¢«ç”¨ä½œæ ¼å¼æ ¡éªŒï¼Œæ•°æ®åº“å…³ç³»æ˜ å°„ç­‰ã€‚jsonã€bsonã€ormï¼Œhttpå‚æ•°ç­‰

```go
package main

import (
	"fmt"
	"reflect"
)

func main() {
	type User struct {
		id   int    `field:"uid" type:"integer"`
		name string `field:"name" type:"text"`
	}
	t := reflect.TypeOf(User{})
	for i := 0; i < t.NumField(); i++ {
		f := t.Field(i)
		fmt.Println(f.Name, f.Tag.Get("field"), f.Tag.Get("type"))
	}
}

// id: uid integer
// name: name text
```

## ç»“æ„ä½“åµŒå¥—

æ‰€è°“åŒ¿åå­—æ®µï¼ˆanonymous fieldï¼‰ï¼Œæ˜¯æŒ‡æ²¡æœ‰åå­—ï¼Œä»…æœ‰ç±»å‹çš„å­—æ®µã€‚ä¹Ÿè¢«ç§°ä½œåµŒå…¥å­—æ®µã€åµŒå…¥ç±»å‹ã€‚ 

éšå¼ä»¥ç±»å‹åä¸ºå­—æ®µåã€‚ åµŒå…¥ç±»å‹ä¸å…¶æŒ‡é’ˆç±»å‹éšå¼å­—æ®µåç›¸åŒã€‚ï¼ˆ * ä¸èƒ½ç”¨äºåç§°ï¼‰ å¯åƒç›´å±å­—æ®µé‚£æ ·ç›´æ¥è®¿é—®ã€‚

```go
type Attr struct {
	perm int
}
type File struct {
	Attr // éšå¼å­—æ®µå Attrï¼Œè¯­æ³•ç³–!
	name string
}
func main() {
	f := File {
		name: "test.dat",
		// å¿…é¡»æ˜¾å¼åç§°åˆå§‹åŒ–ã€‚
		// perm: 0644,
		// ~~~~ unknown field 'perm' in struct literal of type File
		Attr: Attr{
			perm: 0644,
		},
	}
	// åƒç›´å±å­—æ®µè®¿é—®ã€‚
	fmt.Printf("%s, %o\n", f.name, f.perm)
}
```

**ç›´å±å­—æ®µä¸åµŒå…¥å­—æ®µæˆå‘˜å­˜åœ¨é‡åé—®é¢˜**ã€‚

ç¼–è¯‘å™¨ä¼˜å…ˆé€‰æ‹©ç›´å±å‘½åå­—æ®µï¼Œå…¶æ¬¡æŒ‰åµŒå…¥å±‚æ¬¡é€çº§æŸ¥æ‰¾åŒ¿åå­—æ®µæˆå‘˜ã€‚ å¦‚åŒ¿åå­—æ®µæˆå‘˜è¢«å¤–å±‚åŒåé®è”½ï¼Œé‚£ä¹ˆå¿…é¡»ç”¨æ˜¾å¼å­—æ®µåã€‚

```go
type File struct {
	name []byte
}

type Data struct {
	File
	name string // å’Œ File.name é‡åã€‚
}

func main() {
	d := Data{
		name: "data",
		File: File{ []byte("file") },
	}

	d.name = "data2" // ä¼˜å…ˆé€‰æ‹©ç›´å±å‘½åå­—æ®µã€‚
	d.File.name = []byte("file2")

	fmt.Println(d.name, d.File.name)
}
```

åŒ¿ååµŒå…¥æ˜¯ ç»„åˆï¼ˆcompositionï¼‰ï¼Œè€Œé ç»§æ‰¿ï¼ˆinheritanceï¼‰ã€‚ ç»“æ„è™½ç„¶æ‰¿è½½äº† class åŠŸèƒ½ï¼Œä½†æ— æ³• å¤šæ€ï¼ˆpolymorphisnï¼‰ï¼Œåªèƒ½ä»¥æ–¹æ³•é›†é…åˆæ¥å£å®ç°ã€‚

## å†…å­˜å¯¹é½

ä¸ç®¡ç»“æ„åŒ…å«å¤šå°‘å­—æ®µï¼Œå…¶å†…å­˜æ€»æ˜¯ä¸€æ¬¡æ€§åˆ†é…ï¼Œå„å­—æ®µï¼ˆå«åŒ¿åå­—æ®µæˆå‘˜ï¼‰åœ¨ç›¸é‚»åœ°å€ç©ºé—´æŒ‰å®šä¹‰é¡ºåºï¼ˆå«å¯¹ é½ï¼‰æ’åˆ—ã€‚å½“ç„¶ï¼Œå¯¹äºå¼•ç”¨ç±»å‹ã€å­—ç¬¦ä¸²å’ŒæŒ‡é’ˆï¼Œç»“æ„å†…å­˜ä¸­åªåŒ…å«å…¶åŸºæœ¬ï¼ˆå¤´éƒ¨ï¼‰æ•°æ®ã€‚ å€ŸåŠ© unsafe ç›¸å…³å‡½æ•°ï¼Œè¾“å‡ºæ‰€æœ‰å­—æ®µçš„åç§»é‡å’Œé•¿åº¦ã€‚

å¯¹é½ä»¥æ‰€æœ‰å­—æ®µä¸­æœ€é•¿çš„åŸºç¡€ç±»å‹å®½åº¦ä¸ºå‡†ã€‚ç¼–è¯‘å™¨è¿™ä¹ˆåšçš„ç›®çš„ï¼Œå³ä¸ºäº†æœ€å¤§é™åº¦å‡å°‘è¯»å†™æ‰€éœ€æŒ‡ä»¤ï¼Œä¹Ÿå›  ä¸ºæŸäº›æ¶æ„å¹³å°è‡ªèº«çš„è¦æ±‚ã€‚

```go
package main

import (
	"fmt"
	"unsafe"
)

func main() {
	v1 := struct {
		a byte
		b byte
		c int32 // <-- int32
	}{}

	v2 := struct {
		a byte
		b byte // <-- byte
	}{}

	v3 := struct {
		a byte
		b []int // <-- int
		c byte
	}{}

	fmt.Printf("v1: %d, %d\n", unsafe.Alignof(v1), unsafe.Sizeof(v1))
	fmt.Printf("v2: %d, %d\n", unsafe.Alignof(v2), unsafe.Sizeof(v2))
	fmt.Printf("v3: %d, %d\n", unsafe.Alignof(v3), unsafe.Sizeof(v3))
}

/*
v1: 4, 8
v2: 1, 2
v3: 8, 40
(gdb) x/2xw &v1
0xc000088e88: 0x00000201 0x00000003
+---+---+---+---+---+---+---+---+
| a | b | ? | ? | c |
+---+---+---+---+---+---+---+---+
|<----- 4 ----->|<----- 4 ----->|
(gdb) x/2xb &v2
0xc000088e86: 0x01 0x02
+---+---+
| a | b |
+---+---+
0 1 2
(gdb) x/5xg &v3
0xc000088f48: 0x0000000000000001 0x000000c000088e90
0xc000088f58: 0x0000000000000003 0x0000000000000003
0xc000088f68: 0x0000000000000002
+---+-------+-----------+-----------+-----------+---+-------+
| a | ... | b.ptr | b.len | b.cap | c | ... |
+---+-------+-----------+-----------+-----------+---+-------+
|<--- 8 --->|<--- 8 --->|<--- 8 --->|<--- 8 --->|<--- 8 --->|
*/

```

å¦‚æœç©ºç»“æ„æ˜¯æœ€åä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå°†å…¶å½“åšé•¿åº¦ 1 çš„ç±»å‹ï¼Œé¿å…è¶Šç•Œã€‚

## :point_right:ç»“æ„ä½“æ€»ç»“

- ç›´å±å­—æ®µåå¿…é¡»å”¯ä¸€ã€‚

- æ”¯æŒè‡ªèº«æŒ‡é’ˆç±»å‹æˆå‘˜ã€‚ 

- å¯ç”¨ _ å¿½ç•¥å­—æ®µåã€‚ 

- æ”¯æŒåŒ¿åç»“æ„å’Œç©ºç»“æ„ã€‚ 

- æ”¯æŒåŒ¿ååµŒå…¥å…¶ä»–ç±»å‹ï¼Œç»„åˆçš„æ–¹å¼ï¼ˆè€Œéç»§æ‰¿ï¼‰ã€‚ 

- æ”¯æŒä¸ºå­—æ®µæ·»åŠ æ ‡ç­¾ã€‚ 

- ä»…æ‰€æœ‰å­—æ®µå…¨éƒ¨æ”¯æŒï¼Œæ‰å¯åšç›¸ç­‰æ“ä½œã€‚ 

- å¯ç”¨æŒ‡é’ˆé€‰æ‹©å­—æ®µï¼Œä½†ä¸æ”¯æŒå¤šçº§æŒ‡é’ˆã€‚ 

- å­—æ®µåã€ç±»å‹ã€æ ‡ç­¾åŠæ’åˆ—é¡ºåºå±ç±»å‹ç»„æˆéƒ¨åˆ†ã€‚ 

- é™¤æ ¼å¼å¯¹é½å¤–ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¼˜åŒ–æˆ–è°ƒæ•´å¸ƒå±€

# :point_right:ç±»å‹è½¬æ¢

é™¤å¸¸é‡ã€åˆ«åä»¥åŠæœªå‘½åç±»å‹å¤–ï¼Œå¼ºåˆ¶è¦æ±‚æ˜¾å¼ç±»å‹è½¬æ¢ `T(v)`ã€‚

```go
a := 100
b := byte(a)    // æ˜¾å¼è½¬æ¢
c := a + int(b) // ç¡®ä¿ç±»å‹ä¸€è‡´

// ä¸æ”¯æŒéšå¼ç±»å‹è½¬æ¢ 
var n int = b  // Error: cannot use b (type byte) as type int in assignment
if a { // The non-bool value 'a' (type int) used as a condition
	...
}
```

ä½¿ç”¨æ‹¬å·é¿å…ä¼˜å…ˆçº§é”™è¯¯

```go
(*int)(p)       // å¦‚æœæ²¡æœ‰æ‹¬å· *(int(p))
(<-chan int)(c) // å¦‚æœæ²¡æœ‰æ‹¬å· <-(chan int(c))
(func())(x)     // å¦‚æœæ²¡æœ‰æ‹¬å· func() x
(func() int)(x) // --> æœ‰è¿”å›å€¼çš„å‡½æ•°ç±»å‹å¯çœç•¥æ‹¬å·ï¼Œä½†ä¾ç„¶å»ºè®®ä½¿ç”¨ã€‚
(func() int)(x) // ä½¿ç”¨æ‹¬å·åï¼Œæ›´æ˜“é˜…è¯»ã€‚
```

è½¬æ¢æ—¶ç¡®ä¿æ•´æ•°è½¬æ¢ä¸ä¼šé€ æˆæ•°æ®æˆªæ–­æˆ–è€…ç¬¦å·é”™è¯¯

```go
var a = math.MaxInt32
b := int16(a) // ä¸ç¬¦åˆï¼Œä¸åŒç±»å‹å¼ºåˆ¶è½¬åŒ–æ•°æ®ä¼šå‘ç”Ÿæ•°æ®æˆªæ–­

var a = math.MinInt32
b := uint32(a) // ä¸ç¬¦åˆï¼Œäº§ç”Ÿç¬¦å·ä¸¢å¤±
```

**ç±»å‹è½¬æ¢è¯´æ˜**

- åªèƒ½å¼ºåˆ¶æ˜¾ç¤ºè½¬æ¢ç±»å‹
- é¿å…ä¼˜å…ˆçº§é”™è¯¯
- ç¡®ä¿è½¬æ¢åæ•°æ®å®‰å…¨ï¼Œä¸ä¼šé€ æˆæ•°æ®æˆªæ–­æˆ–è€…ç¬¦å·é”™è¯¯ã€‚

### :point_right:è‡ªå®šä¹‰ç±»å‹å’Œåˆ«å

ä½¿ç”¨å…³é”®å­— `type` å®šä¹‰ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹

```go
type A int   // å®šä¹‰æ–°ç±»å‹
type B = int // åˆ«å

var a A = 10
var b B = 10
var c int = 10

fmt.Println(a + c) // é”™è¯¯ï¼šInvalid operation: a + c (mismatched types A and int)
fmt.Println(b + c)
fmt.Println(a > 8) // goç¼–è¯‘å™¨ä¼šå¼ºåˆ¶è½¬æ¢A(8)
```

**è‡ªå®šä¹‰ç±»å‹å’Œåˆ«åè¯´æ˜**

- å³ä½¿åº•å±‚ç±»å‹ç›¸åŒï¼Œä¹ŸéåŒä¸€ç±»å‹ã€‚ï¼ˆåŒºåˆ«äºåˆ«åï¼‰ 
- é™¤è¿ç®—ç¬¦å¤–ï¼Œä¸ç»§æ‰¿ä»»ä½•ä¿¡æ¯ã€‚ 
- ä¸èƒ½éšå¼è½¬æ¢ï¼Œä¸èƒ½å’Œåº•å±‚ç±»å‹ç›´æ¥æ¯”è¾ƒã€è¿ç®—ã€‚
- åˆ«åå¯ä»¥å’Œåº•å±‚ç±»å‹è¿›è¡Œè¿ç®—å’Œç¬”è®°

### :point_right:ç±»å‹æ¯”è¾ƒ

**å¯ä»¥æ¯”è¾ƒå¤§å°**

- ç›¸åŒçš„åŸºç¡€æ•°æ®ç±»å‹

**å¯ä»¥æ¯”è¾ƒç›¸ç­‰ `==`** 

- ç›¸åŒçš„åŸºç¡€æ•°æ®ç±»å‹
- ç›¸åŒé•¿åº¦å’Œç±»å‹çš„æ•°ç»„

- ç›¸åŒæˆå‘˜å’Œç±»å‹ï¼Œå¹¶ä¸”æˆå‘˜å¯ä»¥æ¯”è¾ƒçš„ç»“æ„ä½“
- ç›¸åŒç±»å‹çš„channel
- ç›¸åŒç±»å‹çš„åˆ«å

**ä¸å¯ä»¥ç›´æ¥æ¯”è¾ƒ**

- è‡ªå®šä¹‰ç±»å‹å’Œåº•å±‚ç±»å‹ä¸å¯æ¯”è¾ƒï¼Œæ˜¯ä¸¤ç§ä¸åŒçš„ç±»å‹
- sliceã€mapã€funcåŒç±»å‹é—´ä¸èƒ½ç›´æ¥æ¯”è¾ƒï¼Œåªèƒ½å’Œ `nil` æ¯”è¾ƒ

> ä½†å¯ä»¥ä½¿ç”¨reflect.DeepEqualæˆ–è€…cmpåŒ…æ¥æ¯”è¾ƒ

# å‡½æ•°

å‡½æ•°æ˜¯ç»“æ„åŒ–ç¼–ç¨‹çš„æœ€å°æ¨¡å—å•å…ƒï¼Œå‡½æ•°å¯ä»¥è®©æˆ‘ä»¬å°†ä¸€ä¸ªè¯­å¥åºåˆ—æ‰“åŒ…ä¸ºä¸€ä¸ªå•å…ƒï¼Œç„¶åå¯ä»¥ä»ç¨‹åºä¸­å…¶å®ƒåœ°æ–¹å¤šæ¬¡è°ƒç”¨ã€‚

å‡½æ•°å°†å¤æ‚è¿‡ç¨‹åˆ†è§£æˆè‹¥å¹²è¾ƒå°ä»»åŠ¡ï¼Œéšè—ç»†èŠ‚ï¼Œä½¿å¾—ç¨‹åºç»“æ„æ›´åŠ æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ã€‚

## å‡½æ•°å£°æ˜

ä½¿ç”¨å…³é”®å­— func ç”¨äºå®šä¹‰å‡½æ•°ï¼Œå£°æ˜åŒ…æ‹¬å‡½æ•°åã€å½¢å¼å‚æ•°åˆ—è¡¨ã€è¿”å›å€¼åˆ—è¡¨ï¼ˆå¯çœç•¥ï¼‰ä»¥åŠå‡½æ•°ä½“ã€‚

```go
func name(parameter-list) (result-list) {
    body
}
func f(i, j, k int, s, t string)                 { /* ... */ }
func f(i int, j int, k int,  s string, t string) { /* ... */ }
```

å¦‚æœå®å‚åŒ…æ‹¬å¼•ç”¨ç±»å‹ï¼Œå¦‚æŒ‡é’ˆï¼Œslice(åˆ‡ç‰‡)ã€mapã€functionã€channelç­‰ç±»å‹ï¼Œå®å‚å¯èƒ½ä¼šç”±äºå‡½æ•°çš„é—´æ¥å¼•ç”¨è¢«ä¿®æ”¹ã€‚

```go
func changeS(s []int) error{
    if len(s) < 1 {
        return errors.New("length err")
    }
    s[0] = 8
    return nil
}
```

ä¸èƒ½åœ¨å‡½æ•°é‡Œé¢å£°æ˜å‡½æ•°

```go
func main() {
    // ä¸æ”¯æŒå‘½åå‡½æ•°ï¼Œéœ€æ”¹ç”¨åŒ¿åçš„æ–¹å¼
    // func add() {}  
}
```

## :point_right:å€¼æ‹·è´ä¼ é€’

ä¸ç®¡æ˜¯æŒ‡é’ˆã€å¼•ç”¨ç±»å‹ï¼Œè¿˜æ˜¯å…¶ä»–ç±»å‹ï¼Œå‚æ•°æ€»æ˜¯ å€¼æ‹·è´ä¼ é€’ï¼ˆpass by valueï¼‰ã€‚åŒºåˆ«æ— éæ˜¯å¤åˆ¶å®Œæ•´ç›®æ ‡å¯¹ è±¡ï¼Œè¿˜æ˜¯ä»…å¤åˆ¶å¤´éƒ¨æˆ–æŒ‡é’ˆè€Œå·²ã€‚

```go
//go:noline
func test(x *int, s []int) {
	println(*x, len(s))
}

func main() {
    x := 100
    s := []int{1, 2, 3}
    test(&x, s)
}

/*
$ go build
$ go tool objdump -S -s "main\.main" ./test
func main() {
    x := 100
  	 0x462c94 MOVQ $0x64, 0x20(SP)

    s := []int{1, 2, 3}
     0x462ca9 MOVQ $0x1, 0x28(SP)
     0x462cb2 MOVQ $0x2, 0x30(SP)
     0x462cbb MOVQ $0x3, 0x38(SP)

    test(&x, s)
     0x462cc4 LEAQ 0x20(SP), AX ; &x
     0x462cc9 LEAQ 0x28(SP), BX ; s.ptr
     0x462cce MOVL $0x3, CX ; s.len
     0x462cd3 MOVQ CX, DI
     0x462cd6 CALL main.test(SB)
}
*/
```

## :point_right:å¯å˜å‚æ•°

å˜å‚æœ¬è´¨ä¸Šå°±æ˜¯åˆ‡ç‰‡ã€‚åªèƒ½æ¥æ”¶ä¸€åˆ°å¤šä¸ªåŒç±»å‹å‚æ•°ï¼Œä¸”å¿…é¡»æ”¾åœ¨åˆ—è¡¨å°¾éƒ¨

```go
func test(s string, a ...int) {
	fmt.Printf("%T, %v\n", a, a)
}

func main() {
	test("abc", 1, 2, 3, 4)
}
```

å½“åˆ‡ç‰‡ä¸ºå‚æ•°æ—¶å¿…é¡»å±•å¼€

```go
func test(a ...int) {
	fmt.Println(a)
}

func main() {
    a := [3]int{10, 20, 30}
    
     // è½¬æ¢ä¸ºåˆ‡ç‰‡åå±•å¼€ã€‚
    test(a[:]...)
    var s []int
    s = append(s, []int{1,2,3}...) // è¿½åŠ ä¸€ä¸ªåˆ‡ç‰‡, åˆ‡ç‰‡éœ€è¦è§£åŒ…
}
```

æ—¢ç„¶å˜å‚æ˜¯åˆ‡ç‰‡ï¼Œé‚£ä¹ˆå‚æ•°å¤åˆ¶çš„ä»…æ˜¯åˆ‡ç‰‡è‡ªèº«ã€‚æ­£å› å¦‚æ­¤ï¼Œå°±æœ‰æœºä¼šä¿®æ”¹å®å‚ã€‚

```go
//go:noinline
func test(a ...int) {
	for i := range a {
		a[i] += 100
	}
}
func main() {
	a := []int{1, 2, 3}
	test(a...)
	println(a[1])
}

// 102
```

## å‚æ•°ç”Ÿå‘½å‘¨æœŸ

å‚æ•°å’Œå…¶ä»–å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæœªå¿…èƒ½åšæŒåˆ°å‡½æ•°è°ƒç”¨ç»“æŸã€‚ 

åƒåœ¾å›æ”¶éå¸¸ç§¯æï¼Œå¯¹åç»­ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šæå‰æ¸…ç†ã€‚

```go
//go:noinline
func test(x []byte) {
    println(len(x))
     // æ¨¡æ‹Ÿåƒåœ¾å›æ”¶è§¦å‘ã€‚
    runtime.SetFinalizer(&x, func(*[]byte){ println("drop!") })
    runtime.GC()
    println("exit.")

     // ç¡®ä¿ç›®æ ‡æ´»ç€ã€‚
    // runtime.KeepAlive(&x)
}

func main() {
    test(make([]byte, 10<<20))
}
// 10485760
// drop!
// exit.
```

## å¤šè¿”å›å€¼

ä¸€ä¸ªå‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ã€‚

```go
func getInfo(id string) (string, error) {
	return "", nil
}
```

## å…·åè¿”å›å€¼

å…·åè¿”å›å¯ä»¥ä¼ è¾¾å‡½æ•°è¿”å›å€¼çš„å«ä¹‰ã€‚å°¤å…¶åœ¨è¿”å›å€¼çš„ç±»å‹éƒ½ç›¸åŒæ—¶

```go
func add(x, y int) (sum int) {
    sum = x + y
    return 
    
    // æ˜¾ç¤ºè¿”å›
    // c = sum + 1
    // return c
}
```

**å¯ä»¥æ˜¾ç¤ºè¦†ç›–è¿”å›å€¼**

```go
func add(x, y int) (sum int) {
    sum = x + y
   
    // æ˜¾ç¤ºè¿”å›
    c := sum + 1
    return c
}
```

è¦ä¹ˆä¸å…·åè¿”å›ï¼Œè¦ä¹ˆå…¨éƒ¨å…·åè¿”å›ï¼Œå¦åˆ™ä¼šæŠ¥é”™

```go
func test() (int, s string, e error) {
    // return 0, "", nil
    // ~ cannot use 0 as string value in return statement
}
```

## :point_right:åŒ¿åå‡½æ•°

åŒ¿åå‡½æ•°æ˜¯æŒ‡æ²¡æœ‰åå­—ç¬¦å·çš„å‡½æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå’Œæ™®é€šå‡½æ•°ç±»ä¼¼ã€‚ 

- å¯åœ¨å‡½æ•°å†…å®šä¹‰åŒ¿åå‡½æ•°ï¼Œå½¢æˆåµŒå¥—ã€‚ 

- å¯éšå®šä¹‰ç›´æ¥ä¼ å‚è°ƒç”¨ï¼Œå¹¶è¿”å›ç»“æœã€‚ 

- å¯ä¿å­˜åˆ°å˜é‡ã€ç»“æ„å­—æ®µï¼Œæˆ–ä½œä¸ºå‚æ•°ã€è¿”å›å€¼ä¼ é€’ã€‚

   

- åŒ¿åå‡½æ•°å¯å¼•ç”¨ç¯å¢ƒå˜é‡ï¼Œå½¢æˆé—­åŒ…ã€‚ 

- ä¸æ›¾ä½¿ç”¨çš„åŒ¿åå‡½æ•°è¢«å½“ä½œé”™è¯¯ã€‚ 

- ä¸èƒ½ä½¿ç”¨ç¼–è¯‘æŒ‡ä»¤ã€‚ï¼ˆ //go:noinline ï¼‰

```go
func main() {
	// å˜é‡
	add := func(x, y int) int {
		return x + y
	}
	_ = add(1, 2)
}
```

ç¼–è¯‘å™¨ä¸ºåŒ¿åå‡½æ•°è‡ªåŠ¨ç”Ÿæˆåå­—ã€‚

```go
func main() {
    func() {
    	println("abc")
    }()
}
/*
$ go build -gcflags "-l"
$ go tool objdump -S -s "main\.main" ./test
CALL main.main.func1(SB)
*/
```

## :point_right:é—­åŒ…

é—­åŒ…ï¼ˆclosureï¼‰æ˜¯åŒ¿åå‡½æ•°å’Œå…¶å¼•ç”¨çš„å¤–éƒ¨ç¯å¢ƒå˜é‡ç»„åˆä½“ã€‚

```go
//go:noinline
func test() func() {
    x := 100
    println(&x, x)
    
    return func() { // è¿”å›é—­åŒ…ï¼Œè€Œéå‡½æ•°ã€‚
        x++
        println(&x, x) // å¼•ç”¨ç¯å¢ƒå˜é‡ x ã€‚
    }
}
func main() {
	test()()
}
/*
0xc000018060 100
0xc000018060 101
*/
```

é—­åŒ…ä¼šå»¶é•¿ç¯å¢ƒå˜é‡ç”Ÿå‘½å‘¨æœŸã€‚ 

æ‰€è°“é—­åŒ…ï¼Œå®è´¨ä¸Šæ˜¯ç”±åŒ¿åå‡½æ•°å’Œï¼ˆä¸€åˆ°å¤šä¸ªï¼‰ç¯å¢ƒå˜é‡æŒ‡é’ˆæ„æˆçš„ç»“æ„ä½“ã€‚

### é—­åŒ…åº”ç”¨

ç»‘å®šå±€éƒ¨å˜é‡

```go
func test() func() {
    n := 0
    return func() {
        n++
        println("call:", n)
    }
}

func main() {
    f := test()
    f()
    f()
    f()
}
/*
call: 1
call: 2
call: 3
*/
```

ç»‘å®šçŠ¶æ€ï¼ˆæ¨¡æ‹Ÿç»“æ„ä½“æ–¹æ³•ï¼‰

```go
func handle(db Database) func(http.ResponseWriter, *http.Request) {
    return func(w http.ResponseWriter, r *http.Request) {
        url := db.Get()
        io.WriteString(w, url)
    }
}

func main() {
    db := NewDatabase("localhost:5432")

    http.HandleFunc("/url", handle(db))
    http.ListenAndServe(":3000", nil)
}
```

ä½œä¸ºè£…é¥°å™¨ä½¿ç”¨ï¼ŒåŒ…è£…å‡½æ•°ï¼Œæ”¹å˜å…¶ç­¾åæˆ–å¢åŠ é¢å¤–åŠŸèƒ½ã€‚

```go
// å¢åŠ åŠŸèƒ½ã€‚
func proxy(f func()) func() {
    return func() {
        n := time.Now()
        defer func() {
        	fmt.Println(time.Now().Sub(n))
        }()

        f()
    }
}
```

## :point_right:defer å»¶è¿Ÿè°ƒç”¨

è¯­å¥ defer æ³¨å†Œ ç¨åæ‰§è¡Œçš„å‡½æ•°è°ƒç”¨ã€‚è¿™äº›è°ƒç”¨è¢«ç§°ä½œ å»¶è¿Ÿè°ƒç”¨ï¼Œå› ä¸ºå®ƒä»¬ç›´åˆ°å½“å‰å‡½æ•°ç»“æŸå‰ï¼ˆ RET ï¼‰æ‰è¢«æ‰§è¡Œã€‚

- å¸¸ç”¨äºèµ„æºé‡Šæ”¾ã€é”å®šè§£é™¤ï¼Œä»¥åŠé”™è¯¯å¤„ç†ç­‰æ“ä½œã€‚ 
- å¤šä¸ªå»¶è¿Ÿè°ƒç”¨æŒ‰ FILO æ¬¡åºæ‰§è¡Œã€‚ 
- è¿è¡Œæ—¶ç¡®ä¿å»¶å»¶è¿Ÿè°ƒç”¨æ€»è¢«æ‰§è¡Œã€‚ï¼ˆ os.Exit é™¤å¤–ï¼‰

```go
func main() {
    f, err := os.Open("./main.go")
    if err != nil {
    	log.Fatalln(err)
    }

    defer f.Close()
    
    b, err := io.ReadAll(f)
    if err != nil {
    	log.Fatalln(err)
    }
    println(string(b))
}
```

:point_right:æ­£å¸¸é€€å‡ºï¼Œæˆ–ä»¥ panic ä¸­æ–­ï¼Œè¿è¡Œæ—¶éƒ½ä¼šç¡®ä¿å»¶è¿Ÿå‡½æ•°è¢«æ‰§è¡Œã€‚

```go
func main() {
    defer println("defer!")
    panic("panic!") // æ¢æˆ os.Exitï¼Œä¼šç«‹å³ç»ˆæ­¢è¿›ç¨‹ï¼Œ
} 
/*
defer!
panic: panic!
*/
```

æ³¨æ„å‚æ•°å¤åˆ¶è¡Œä¸ºï¼Œå¿…è¦æ—¶ä»¥æŒ‡é’ˆæˆ–å¼•ç”¨ç±»å‹ä»£æ›¿ã€‚

```go
func main() {
    x := 100
    defer println("defer:", x)
    x++
    println("main:", x)
}
/*
main: 101
defer: 100
*/
```

### :point_right:å…·åè¿”å›ä¸‹çš„defer

æ³¨æ„deferçš„æ‰§è¡Œé¡ºåºï¼Œå‡½æ•°æ‰§è¡Œ -> defer -> returnï¼Œå…·åè¿”å›ä¼šé¢„å…ˆç”³è¯·è¿”å›å€¼çš„åœ°å€

```go
func test() (z int) {
    defer func() {
    	z += 200
    }()
    return 100 // return = (ret_val_z = 100, call defer, ret)
}

func main() {
	println(test()) // 300
}
```

å¦‚æœä¸æ˜¯å…·åè¿”å›

```go
func test() int {
    z := 0
    defer func() {
    	z += 200 // æœ¬åœ°å˜é‡ï¼Œä¸è¿”å›å€¼æ— å…³ã€‚z æ˜¯deferæ‰§è¡Œfuncçš„zï¼Œä¸æ˜¯å¤–é¢çš„z
    }()

    z = 100
    return z // return = (ret_val = 100, call defer, ret)
}

func main() {
	println(test()) // 100
}
```

## é”™è¯¯å¤„ç†

å¿…é¡»æ£€æŸ¥æ‰€æœ‰è¿”å›é”™è¯¯ï¼Œè¿™ä¹Ÿå¯¼è‡´ä»£ç ä¸å¤ªç¾è§‚ã€‚

```go
func main() {
    file, err := os.Open("./main.go")
    if err != nil {
    	log.Fatalln(err)
    }
    defer file.Close()
    
    content, err := io.ReadAll(file)
    if err != nil {
    	log.Fatalln(err)
    }
   
    fmt.Println(string(content))
}
```

errorä¹Ÿæ˜¯å€¼ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ == ã€!= è¿›è¡Œæ¯”è¾ƒ

- err != nil ï¼šæ˜¯å¦æœ‰é”™è¯¯ã€‚
- err == ErrVar ï¼šæŸä¸ªå…·ä½“é”™è¯¯ã€‚ 
- case ErrVal ï¼šé”™è¯¯åŒ¹é…ã€‚ 
- e, ok := err.(T) ï¼šç±»å‹è½¬æ¢ã€‚

æ ‡å‡†åº“ï¼š

- errors.New : åˆ›å»ºé”™è¯¯å¯¹è±¡ã€‚ 
- fmt.Errorf : ä»¥ %w åŒ…è£…é”™è¯¯å¯¹è±¡ï¼Œæ„å»ºé”™è¯¯é“¾ã€‚ 

åŒ…è£…å¯¹è±¡ï¼š 

- errors.Unwrap : è¿”å›è¢«åŒ…è£…é”™è¯¯å¯¹è±¡ã€‚ 
- errors.Is : é€’å½’é”™è¯¯é“¾ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æŒ‡å®šé”™è¯¯å¯¹è±¡ã€‚ 
- errors.As : é€’å½’é”™è¯¯é“¾ï¼ŒæŸ¥æ‰¾ç±»å‹ç›¸ç¬¦çš„å¯¹è±¡ã€‚

## :point_right:panic/recover

Goçš„ç±»å‹ç³»ç»Ÿä¼šåœ¨ç¼–è¯‘æ—¶æ•è·å¾ˆå¤šé”™è¯¯ï¼Œä½†æœ‰äº›é”™è¯¯åªèƒ½åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œå¦‚æ•°ç»„è®¿é—®è¶Šç•Œã€ç©ºæŒ‡é’ˆå¼•ç”¨ç­‰ã€‚è¿™äº›è¿è¡Œæ—¶é”™è¯¯ä¼šå¼•èµ·panicå¼‚å¸¸ã€‚

ä¸è¿”å› error ç›¸æ¯”ï¼Œ panic / recover çš„ä½¿ç”¨æ–¹å¼ï¼Œå¾ˆåƒç»“æ„åŒ–å¼‚å¸¸ã€‚

```go
func panic(v any)
func recover() any

func Reset(x *Buffer) {
    if x == nil {
        panic("x is nil") // unnecessary!
    }
    x.elements = nil
}
```

åœ¨deferå‡½æ•°ä¸­è°ƒç”¨äº†å†…ç½®å‡½æ•°recoverï¼Œå¹¶ä¸”å®šä¹‰è¯¥deferè¯­å¥çš„å‡½æ•°å‘ç”Ÿäº†panicå¼‚å¸¸ï¼Œrecoverä¼šä½¿ç¨‹åºä»panicä¸­æ¢å¤ï¼Œå¹¶è¿”å›panic valueã€‚å¯¼è‡´panicå¼‚å¸¸çš„å‡½æ•°ä¸ä¼šç»§ç»­è¿è¡Œï¼Œä½†èƒ½æ­£å¸¸è¿”å›ã€‚åœ¨æœªå‘ç”Ÿpanicæ—¶è°ƒç”¨recoverï¼Œrecoverä¼šè¿”å›nilã€‚

```go
func Parse(input string) (s *Syntax, err error) {
    defer func() {
        if p := recover(); p != nil {
            err = fmt.Errorf("internal error: %v", p)
        }
    }()
    // ...parser...
}
```

æ³¨æ„æ•è·é¡ºåº

```go
func main() {
    defer func() {
        log.Println(recover()) // æ•è·ç¬¬äºŒæ¬¡ï¼šp2
    }()

    func() {
        defer func(){
            panic("p2") // ç¬¬äºŒæ¬¡ï¼
        }()
        defer func() {
            log.Println(recover()) // æ•è·ç¬¬ä¸€æ¬¡ï¼šp1
        }()
        panic("p1") // ç¬¬ä¸€æ¬¡ï¼
    }()
    println("exit.")
}
// p1
// p2
```

å¿…é¡»åœ¨deferä¸­ä½¿ç”¨recover

```go
func catch() {
    recover()
}

func main() {
    defer catch() // æœ‰æ•ˆï¼åœ¨å»¶è¿Ÿå‡½æ•°å†…ç›´æ¥è°ƒç”¨ã€‚
    // defer log.Println(recover()) // æ— æ•ˆï¼ä½œä¸ºå‚æ•°ç«‹å³æ‰§è¡Œã€‚
    // defer recover() // æ— æ•ˆï¼è¢«ç›´æ¥æ³¨å†Œä¸ºå»¶è¿Ÿè°ƒç”¨ã€‚
    panic("p!")
}
```

## :point_right:å‡½æ•°æ€»ç»“

- å‡½æ•°åªèƒ½åˆ¤æ–­æ˜¯å¦ä¸º nil ï¼Œä¸æ”¯æŒæ¯”è¾ƒæ“ä½œã€‚
- å¼€å‘è¿‡ç¨‹ä¸­éå¿…è¦ä¸è¦ä¿®æ”¹å¼•ç”¨ç±»å‹çš„å€¼.
- å¼€å‘è¿‡ç¨‹ä¸­éå¿…è¦ä¸ä½¿ç”¨å…·åè¿”å›ã€‚
- å¼€å‘è¿‡ç¨‹ä¸­éå¿…è¦ä¸ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚
- deferè®¾è®¡è¿”å›å€¼ï¼Œåº”æ³¨æ„æ˜¯å¦æ˜¯å…·åè¿”å›ï¼ˆæˆ–è€…æŒ‡é’ˆï¼‰ï¼Œä»¥é˜²æ­¢ç»“æœè¾¾ä¸åˆ°é¢„æœŸã€‚
- å¼€å‘è¿‡ç¨‹ä¸­ç¦æ­¢åœ¨å¾ªç¯é‡Œä½¿ç”¨deferã€‚
- é™¤mainå‡½æ•°ç‰¹æ®Šåœºæ™¯å¤–ï¼ˆå¦‚å…³é—­èµ„æºã€è¿æ¥ç­‰ï¼‰ï¼Œå…¶ä»–å¿…é¡»æ£€æŸ¥erré”™è¯¯ã€‚
- å¼€å‘è¿‡ç¨‹ä¸­éå¿…è¦ä¸ä½¿ç”¨panicã€‚
- recoverå‡½æ•°å¿…é¡»åœ¨deferä¸­ä½¿ç”¨ï¼Œ:point_right:åªèƒ½æ•è·å½“å‰goç¨‹çš„panicã€‚

# æ–¹æ³•

æ–¹æ³•æ˜¯ä¸å¯¹è±¡å®ä¾‹ç›¸ç»‘å®šçš„ç‰¹æ®Šå‡½æ•°ã€‚ç”¨äºç»´æŠ¤å’Œå±•ç¤ºå¯¹è±¡è‡ªèº«çŠ¶æ€ã€‚å¯¹è±¡æ˜¯å†…æ•›çš„ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰å„è‡ªä¸åŒçš„ç‹¬ç«‹ç‰¹å¾ï¼Œä»¥å±æ€§å’Œæ–¹æ³•æ¥å¯¹å¤–æš´éœ²ã€‚

åœ¨å‡½æ•°å£°æ˜æ—¶ï¼Œåœ¨å…¶åå­—ä¹‹å‰æ”¾ä¸Šä¸€ä¸ªå˜é‡ï¼Œå³æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªé™„åŠ çš„å‚æ•°ä¼šå°†è¯¥å‡½æ•°é™„åŠ åˆ°è¿™ç§ç±»å‹ä¸Šï¼Œå³ç›¸å½“äºä¸ºè¿™ç§ç±»å‹å®šä¹‰äº†ä¸€ä¸ªç‹¬å çš„æ–¹æ³•ã€‚

```go
package geometry

import "math"

type Point struct{ X, Y float64 }

// function
func Distance(p, q Point) float64 {
    return math.Hypot(q.X-p.X, q.Y-p.Y)
}

// method 
func (p Point) Distance(q Point) float64 {
    return math.Hypot(q.X-p.X, q.Y-p.Y)
}
```

## åŸºäºæŒ‡é’ˆå¯¹è±¡çš„æ–¹æ³•

å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šå¯¹å…¶æ¯ä¸€ä¸ªå‚æ•°å€¼è¿›è¡Œæ‹·è´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°éœ€è¦æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œæˆ–è€…å‡½æ•°çš„å…¶ä¸­ä¸€ä¸ªå‚æ•°å®åœ¨å¤ªå¤§æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé¿å…è¿›è¡Œè¿™ç§é»˜è®¤çš„æ‹·è´ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°æŒ‡é’ˆäº†ã€‚

```go
func (p *Point) ScaleBy(factor float64) {
    p.X *= factor
    p.Y *= factor
}
```

- ä¿®æ”¹å®ä¾‹çŠ¶æ€ï¼Œç”¨ *T ã€‚ 
- ä¸ä¿®æ”¹çŠ¶æ€çš„å°å¯¹è±¡æˆ–å›ºå®šå€¼ï¼Œç”¨ T ã€‚ 
- å¤§å¯¹è±¡ç”¨ *T ï¼Œå‡å°‘å¤åˆ¶æˆæœ¬ã€‚ 
- å¼•ç”¨ç±»å‹ã€å­—ç¬¦ä¸²ã€å‡½æ•°ç­‰æŒ‡é’ˆåŒ…è£…å¯¹è±¡ï¼Œç”¨ T ã€‚ 
- å« Mutex ç­‰åŒæ­¥å­—æ®µï¼Œç”¨ *T ï¼Œé¿å…å› å¤åˆ¶é€ æˆé”æ— æ•ˆã€‚ 
- å…¶ä»–æ— æ³•ç¡®å®šçš„ï¼Œéƒ½ç”¨ *T ã€‚

## åµŒå¥—å’ŒåŒ¿ååµŒå¥—

```go
import "image/color"

type Point struct{ X, Y float64 }

type ColoredPoint struct {
    Point
    Color color.RGBA
}
```

æŒ‰æœ€å°æ·±åº¦ä¼˜å…ˆåŸåˆ™ã€‚ å¦‚ä¸¤ä¸ªåŒåæ–¹æ³•æ·±åº¦ç›¸åŒï¼Œé‚£ä¹ˆç¼–è¯‘å™¨æ— æ³•ä½œå‡ºé€‰æ‹©ï¼ˆambiguous selectorï¼‰ï¼Œéœ€æ˜¾å¼æŒ‡å®šã€‚

```go
type E struct{}
type T struct {
    E
}
func (E) toString() string { return "E" }
func (t T) toString() string { return "T." + t.E.toString() }
// ----------------------------------
func main() {
    var t T
    println(t.toString()) // T.E
    println(t.E.toString()) // E
}
```

- åƒè®¿é—®åŒ¿åå­—æ®µæˆå‘˜é‚£æ ·è°ƒç”¨å…¶æ–¹æ³•ï¼Œç”±ç¼–è¯‘å™¨è´Ÿè´£æŸ¥æ‰¾ã€‚
- å†…éƒ¨çš„ç»“æ„ä½“åªèƒ½ç®¡ç†è‡ªå·±çš„å­—æ®µ

## :point_right:æ–¹æ³•é›†

ç±»å‹æœ‰ä¸ªä¸ä¹‹ç›¸å…³çš„æ–¹æ³•é›†åˆï¼ˆmethod setï¼‰ï¼Œè¿™å†³å®šäº†å®ƒæ˜¯å¦å®ç°æŸä¸ªæ¥å£ã€‚

æ ¹æ®æ¥æ”¶å‚æ•°ï¼ˆreceiverï¼‰çš„ä¸åŒï¼Œå¯åˆ†ä¸º T å’Œ *T ä¸¤ç§è§†è§’ã€‚å¦‚T å®ç°æ¥å£ï¼Œé‚£ä¹ˆé€è¿‡æ¥å£è°ƒç”¨æ—¶ï¼Œ receiver å¤åˆ¶å¯ä»¥ï¼Œè·å–æŒ‡é’ˆï¼ˆ &T ï¼‰ä¸è¡Œã€‚ ç›¸åï¼Œ *T å®ç°æ¥å£ï¼Œç›®æ ‡å¯¹è±¡åœ¨å¤–ï¼Œæ— è®ºæ˜¯å–å€¼è¿˜æ˜¯å¤åˆ¶æŒ‡é’ˆéƒ½æ²¡é—®é¢˜ã€‚

```bash
T.set = T 
*T.set = T + *T
```

é™¤ç›´å±æ–¹æ³•å¤–ï¼Œåˆ—è¡¨é‡Œè¿˜åŒ…æ‹¬åŒ¿åå­—æ®µçš„æ–¹æ³•ã€‚ 

```go
T{ E } = T + E
T{ *E } = T + E + *E
*T{ E|*E } = T + *T + E + *E
```

### åˆ«åæ‰©å±•

é€šè¿‡ç±»å‹åˆ«åï¼Œå¯¹æ–¹æ³•é›†è¿›è¡Œåˆ†ç±»ï¼Œæ›´ä¾¿äºç»´æŠ¤ã€‚æˆ–æ–°å¢åˆ«åï¼Œä¸ºç±»å‹æ·»åŠ æ‰©å±•æ–¹æ³•ã€‚

```go
type X int
func (*X) A() { println("X.A") }
type Y = X // åˆ«å
func (*Y) B() { println("Y.B") } // æ‰©å±•æ–¹æ³•
func main() {
    var x X
    x.A()
    x.B()
    var y Y
    y.A()
    y.B()
}
```

é€šè¿‡åå°„æŸ¥çœ‹åˆå¹¶æ•ˆæœ

```go
func main() {
    var n X
    t := reflect.TypeOf(&n)
    for i := 0; i < t.NumMethod(); i++ {
        fmt.Println(t.Method(i))
    }
}
// {A func(*main.X) <func(*main.X) Value> 0}
// {B func(*main.X) <func(*main.X) Value> 1}
```

## æ–¹æ³•å€¼å’Œæ–¹æ³•è¡¨è¾¾å¼

p.Addå«ä½œâ€œé€‰æ‹©å™¨â€ï¼Œé€‰æ‹©å™¨ä¼šè¿”å›ä¸€ä¸ªæ–¹æ³•â€œå€¼â€ -> ä¸€ä¸ªå°†æ–¹æ³•ï¼ˆPoint.Addï¼‰ç»‘å®šåˆ°ç‰¹å®šæ¥æ”¶å™¨å˜é‡çš„å‡½æ•°ã€‚

```go
type Point struct{ X, Y float64 }

func (p Point) Add(q Point) Point { return Point{p.X + q.X, p.Y + q.Y} }
func (p Point) Sub(q Point) Point { return Point{p.X - q.X, p.Y - q.Y} }

type Path []Point

func (path Path) TranslateBy(offset Point, add bool) {
    var op func(p, q Point) Point
    if add {
        op = Point.Add
    } else {
        op = Point.Sub
    }
    for i := range path {
        // Call either path[i].Add(offset) or path[i].Sub(offset).
        path[i] = op(path[i], offset)
    }
}
```

## :point_right:æ–¹æ³•æ€»ç»“

- *T å¯ä»¥æ‹¥æœ‰Tç±»å‹çš„èƒ½åŠ›
- å†…éƒ¨çš„ç»“æ„ä½“åªèƒ½ç®¡ç†è‡ªå·±çš„å­—æ®µ

# æ¥å£

æ¥å£æ˜¯åˆçº¦ï¼Œæ˜¯ä¸€ç³»åˆ—æ–¹æ³•çš„é›†åˆã€‚

åªè¦ç›®æ ‡ç±»å‹æ–¹æ³•é›†åŒ…å«æ¥å£å…¨éƒ¨æ–¹æ³•ï¼Œå°±è§†ä¸ºå®ç°è¯¥æ¥å£ï¼Œæ— éœ€æ˜¾ç¤ºå£°æ˜ã€‚ 

```go
type Reader interface {
    Read(p []byte) (n int, err error)
}

type Closer interface {
    Close() error
}

type ReadWriter interface {
    Reader
    Writer
}

type ReadWriteCloser interface {
    Reader
    Writer
    Closer
}
```

- åªèƒ½å£°æ˜æ–¹æ³•ï¼Œä¸èƒ½æœ‰å­—æ®µ, ä¸èƒ½å®ç°ã€‚ 
- ç”³æ˜æ¥å£æ—¶ï¼Œå°½é‡ä¿è¯æ¥å£å°ï¼Œå¯åŒ¿ååµŒå…¥å…¶ä»–æ¥å£ã€‚ 
- æ¥å£åé€šå¸¸ä»¥ er ä½œä¸ºåç§°åç¼€ã€‚ 
- ç©ºæ¥å£ï¼ˆ interface{} , any ï¼‰æ²¡æœ‰ä»»ä½•æ–¹æ³•å£°æ˜ã€‚

## ç©ºæ¥å£å¯ä»¥è¢«èµ‹å€¼ç»™ä»»ä½•å¯¹è±¡

```go
var a any = 123
a = "stb"
```

## ç©ºå€¼åˆ¤æ–­

æ¥å£å†…éƒ¨ç”±ä¸¤ä¸ªå­—æ®µç»„æˆï¼šç±»å‹ å’Œ å€¼ã€‚ 

åªæœ‰ä¸¤å­—æ®µéƒ½ä¸º nil æ—¶ï¼Œæ¥å£æ‰ç­‰äº nil ã€‚å¯åˆ©ç”¨åå°„å®Œå–„åˆ¤æ–­ç»“æœã€‚

ç›¸åŒç±»å‹çš„æ¥å£åº•å±‚å¯ä»¥åš æ¯”è¾ƒæ—¶ï¼Œå¯ä»¥ç”¨ == å¯¹æ¯”

```go
func main() {
    var t1, t2 any
    println(t1 == nil, t1 == t2) // true, true

    t1, t2 = 100, 100
    println(t1 == t2) // true

    // t1, t2 = map[string]int{}, map[string]int{}
    // println(t1 == t2)
    // ~~~~~~~~ panic: comparing uncomparable type map
}
```

## æ¥å£å®ç°

ç›®æ ‡ç±»å‹æ–¹æ³•é›†åŒ…å«æ¥å£å…¨éƒ¨æ–¹æ³•ï¼Œå°±è§†ä¸ºå®ç°è¯¥æ¥å£ï¼Œï¼ˆæ¥å£æœ¬èº«æ˜¯æŒ‡é’ˆï¼‰

çˆ¶é›†æ¥å£ å¯ä»¥ éšå½¢è½¬æ¢æˆå…¶å­é›†ï¼Œåä¹‹ï¼Œå­é›†ä¸èƒ½è½¬æ¢æˆçˆ¶é›†

```go
package main

type Aer interface {
	toString(string) string
}

type Xer interface {
	// Aer
	test()
	toString(string) string
}

type N struct{}

func (*N) test() {}

func (N) toString(s string) string { return s }

func main() {
	var x Xer = &N{} // super
	var a Aer = x // sub
	a.toString("abc")
	// var x2 Xer = a
	// ~ Aer does not implement Xer (missing test method)

	// x2 := Xer(a)
	// ~ Aer does not implement Xer
}
```

## ç±»å‹æ–­è¨€

ç±»å‹æ–­è¨€æ£€æŸ¥å®ƒæ“ä½œå¯¹è±¡çš„åŠ¨æ€ç±»å‹æ˜¯å¦å’Œæ–­è¨€çš„ç±»å‹åŒ¹é…ã€‚ä½¿ç”¨`i.(t)`åŠinterface.(type)çš„æ ¼å¼æ¥åˆ¤æ–­interfaceçš„åº•å±‚ç±»å‹

```go
var w io.Writer
w = os.Stdout
f := w.(*os.File)      // success: f == os.Stdout
c := w.(*bytes.Buffer) // panic: interface holds *os.File, not *bytes.Buffer

```

ä½¿ç”¨okæ¥åˆ¤æ–­ç±»å‹æ˜¯å¦æ­£å¸¸è½¬æ¢

```go
c, ok := w.(*bytes.Buffer) 
if !ok {
    errThings()
}
```

> ä¸ä½¿ç”¨okï¼Œæœ‰panicé£é™©

ä½¿ç”¨ switch æ¥åˆ¤æ–­ç±»å‹

```go
switch i.(type) {
case nil:       // ...
case int, uint: // ...
case bool:      // ...
case string:    // ...
default:        // ...
}
```

>  switch i.(type) ä¸æ”¯æŒ fallthrough

## è®©ç¼–è¯‘å™¨æ£€æŸ¥

å€ŸåŠ©ç¼–è¯‘å™¨ ä½¿ç”¨ `var name interfaceName = some` åˆ¤æ–­æ¥å£æ˜¯å¦å®ç°

```go
type X int
var _ fmt.Stringer = X(0) //
// ~ X does not implement fmt.Stringer (missing String method)

type FuncString func() string
    func (f FuncString) String() string {
        return f()
    }

func main() {
    f := func() string {
   		return "hello, world!"
	}
    
	var t fmt.Stringer = FuncString(f)
	fmt.Println(t)
}
```

## :point_right:æ¥å£æ€»ç»“

- ç±»å‹æ–­è¨€æ—¶ä¸€å®šè¦ä½¿ç”¨okæ¨¡å¼ï¼Œæ£€æŸ¥æ˜¯å¦æ­£å¸¸è½¬æ¢
- æ¥å£çš„switchä¸æ”¯æŒ`fallthrough`
- ä½¿ç”¨å€ŸåŠ©ç¼–è¯‘å™¨æˆ–è€…å¼€å‘å·¥å…·æ£€æŸ¥æ¥å£æ˜¯å¦å®ç°

# Channel - é€šé“

golang é¼“åŠ±ä½¿ç”¨ CSP é€šé“ï¼Œä»¥é€šä¿¡æ¥ä»£æ›¿å†…å­˜å…±äº«ï¼Œå®ç°å¹¶å‘å®‰å…¨

é€šé“ï¼ˆchannelï¼‰è¡Œä¸ºç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¸é™æ”¶å‘äººæ•°ï¼Œä¸å¯é‡å¤æ¶ˆè´¹ã€‚

channelå±äºå¼•ç”¨ç±»å‹ å’Œmapç±»ä¼¼ï¼Œchannelä¹Ÿå¯¹åº”ä¸€ä¸ªmakeåˆ›å»ºçš„åº•å±‚æ•°æ®ç»“æ„çš„å¼•ç”¨ã€‚

```go
ch := make(chan int) // ch has type 'chan int'
```

## åŒæ­¥channel

åŒæ­¥channelæ²¡æœ‰æ•°æ®ç¼“å†²åŒºï¼Œé¡»æ”¶å‘åŒæ–¹åˆ°åœºç›´æ¥äº¤æ¢æ•°æ®ã€‚

- å‘é€æ•°æ®é˜»å¡ï¼Œç›´åˆ°æœ‰å¦ä¸€æ–¹å‡†å¤‡å¦¥å½“æˆ–é€šé“å…³é—­ã€‚ 
- å¯é€šè¿‡ cap == 0 åˆ¤æ–­ä¸ºæ— ç¼“å†²é€šé“ã€‚

```go
ch := make(chan struct{})
```

## å¼‚æ­¥channel

é€šé“è‡ªå¸¦å›ºå®šå¤§å°ç¼“å†²åŒºï¼ˆbufferï¼‰

- å‘é€æ•°æ®æœ‰ç©ºä½æ—¶ï¼Œä¸ä¼šé˜»å¡ã€‚ 
- ç”¨ cap ã€ len è·å–ç¼“å†²åŒºå¤§å°å’Œå½“å‰ç¼“å†²æ•°æ®é‡ã€‚

```go
ch := make(chan struct{},10)
```

## æ¶ˆæ¯æ”¶å‘

ä½¿ç”¨`chan <- value`å‘channelå‘é€æ¶ˆæ¯ã€‚

```go
ch <- v
```

okæ¨¡å¼å–å€¼ï¼Œå¦‚æœokå€¼ä¸ºfalseï¼Œé€šé“è¢«å…³é—­ã€‚

```go
v,ok := <- ch
```

for-rangeå˜é‡å–å€¼

```go
for  v := range ch {
    ...
}
```

## å•å‘channel

å‘é€æ¶ˆæ¯

```go
chan<- type
```

æ¥æ”¶æ¶ˆæ¯

```go
<-chan int
```

åªèƒ½ç”±å‘é€æ–¹ï¼ˆç”Ÿæˆè€…ï¼‰å…³é—­channelã€‚å¦‚ä¸‹

```go
c := make(chan int)
var send chan<- int = c
var recv <-chan int = c

func squarer(send chan<- int) {
    defer close(send)
}

func printer(recv <-chan int) {
 
}
```

## selectå¤šè·¯å¤ç”¨

ç”¨ select è¯­å¥å¤„ç†å¤šä¸ªé€šé“ï¼Œéšæœºé€‰æ‹©å¯ç”¨é€šé“åšæ”¶å‘æ“ä½œã€‚ 

å°†å¤±æ•ˆé€šé“ç½®ä¸º nil ï¼ˆé˜»å¡ï¼Œä¸å¯ç”¨ï¼‰ï¼Œç”¨ä½œç»“æŸåˆ¤æ–­ã€‚

```go
select {
case x, ok = <-ch1: 
    if !ok { 
        ch1 = nil 
    }
case x, ok = <-ch2: 
    if !ok { 
        ch2 = nil
    }
default:
    doSomething()
}
```

ç©º select è¯­å¥ï¼Œä¸€ç›´é˜»å¡ã€‚

```go
select{}
```

## å…³é—­channel

ä½¿ç”¨closeå…³é—­channel

```go
close(ch)
```

å¯¹äº closed æˆ– nil é€šé“ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š 

- æ— è®ºæ”¶å‘ï¼Œ nil é€šé“éƒ½ä¼šé˜»å¡ã€‚ 
- ä¸èƒ½å…³é—­ nil é€šé“ã€‚ 
- é‡å¤å…³é—­é€šé“ï¼Œå¼•å‘ panic ï¼ 
- å‘å·²å…³é—­é€šé“å‘é€æ•°æ®ï¼Œå¼•å‘ panic ï¼ 
- ä»å·²å…³é—­é€šé“æ¥æ”¶æ•°æ®ï¼Œè¿”å›ç¼“å†²æ•°æ®æˆ–é›¶å€¼ã€‚

## :point_right:channelæ€»ç»“

- å¼€å‘æ—¶ä¸ºäº†å¿«é€Ÿæ¶ˆè´¹ï¼Œchannelçš„å®¹é‡è¦ä¹ˆä¸º0ï¼Œè¦ä¹ˆä¸º1ï¼Œä¸å…è®¸æœ‰è¿‡å¤šçš„ç¼“å†²ã€‚
- ä¸¤ä¸ªç›¸åŒç±»å‹çš„channelå¯ä»¥ä½¿ç”¨==è¿ç®—ç¬¦æ¯”è¾ƒã€‚å¦‚æœä¸¤ä¸ªchannelå¼•ç”¨çš„æ˜¯ç›¸åŒçš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„ç»“æœä¸ºçœŸã€‚ä¸€ä¸ªchannelä¹Ÿå¯ä»¥å’Œnilè¿›è¡Œæ¯”è¾ƒã€‚
- channelä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œä¸ºäº†å®‰å…¨å’Œè§„èŒƒï¼Œåªèƒ½ä¼ é€’å•å‘channelã€‚
- åªèƒ½æœ‰ç”Ÿäº§è€…å…³é—­channelã€‚



# Goroutine - goç¨‹

åœ¨Goè¯­è¨€ä¸­ï¼Œæ¯ä¸€ä¸ªå¹¶å‘çš„æ‰§è¡Œå•å…ƒå«ä½œä¸€ä¸ªgoroutineã€‚

ç®€å•å°† goroutine å½’ä¸ºåç¨‹ï¼ˆcoroutineï¼‰å¹¶ä¸åˆé€‚ã€‚ ç±»ä¼¼å¤šçº¿ç¨‹å’Œåç¨‹çš„ç»¼åˆä½“ï¼Œæœ€å¤§é™åº¦æå‡æ‰§è¡Œæ•ˆç‡ï¼Œå‘æŒ¥å¤šæ ¸å¤„ç†èƒ½åŠ›ã€‚ 

**goroutineä¼˜ç‚¹**

- æå°åˆå§‹æ ˆï¼ˆ2 KBï¼‰ï¼ŒæŒ‰éœ€æ‰©å¼ ã€‚ 
- æ— é”å†…å­˜åˆ†é…å’Œå¤ç”¨ï¼Œæå‡å¹¶å‘æ€§èƒ½ã€‚ 
- è°ƒåº¦å™¨å¹³è¡¡ä»»åŠ¡é˜Ÿåˆ—ï¼Œå……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨ã€‚ 
- çº¿ç¨‹è‡ªåŠ¨ä¼‘çœ å’Œå”¤é†’ï¼Œå‡å°‘å†…æ ¸å¼€é”€ã€‚ 
- åŸºäºä¿¡å·ï¼ˆsignalï¼‰å®ç°æŠ¢å å¼ä»»åŠ¡è°ƒåº¦ã€‚

æ‰€æœ‰ç”¨æˆ·ä»£ç éƒ½ä»¥ goroutine æ‰§è¡Œï¼ŒåŒ…æ‹¬ main.main å…¥å£å‡½æ•°ã€‚ å½“ä¸€ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œå…¶ä¸»å‡½æ•°å³åœ¨ä¸€ä¸ªå•ç‹¬çš„goroutineä¸­è¿è¡Œï¼Œæˆ‘ä»¬å«å®ƒmain goroutineã€‚

è¿›ç¨‹ç»“æŸï¼Œä¸ä¼šç­‰å¾…å…¶ä»–æ­£åœ¨æ‰§è¡Œæˆ–å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚

```go
func main(){
    go foo()
}
```

## ç­‰å¾…ä»»åŠ¡ç»“æŸ

ç­‰å¾…ä»»åŠ¡ç»“æŸæ–¹å¼

- time.Sleep  ï¼šç¡çœ ç­‰å¾…ã€‚ä¸æ¨èä½¿ç”¨ã€‚
- channel : ä¿¡å·é€šçŸ¥ã€‚
- WaitGroup ï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡ç»“æŸã€‚ 
- Context ï¼šä¸Šä¸‹æ–‡é€šçŸ¥ã€‚ 
- Mutex ï¼šé”é˜»å¡ã€‚ä¸æ¨èä½¿ç”¨

**channel**

channel çš„æ–¹å¼,é€šçŸ¥æ¶ˆæ¯è¡Œä¸º å¯ä»¥ä½¿ç”¨ç©ºç»“æ„ä½“ã€‚

```go
package main

import (
    "time"
    "fmt"
)

func Process(ch chan int) {
    //Do some work...
    time.Sleep(time.Second)

    ch <- 1 //ç®¡é“ä¸­å†™å…¥ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºå½“å‰åç¨‹å·²ç»“æŸ
}

func main() {
    channels := make([]chan int, 10) //åˆ›å»ºä¸€ä¸ª10ä¸ªå…ƒç´ çš„åˆ‡ç‰‡ï¼Œå…ƒç´ ç±»å‹ä¸ºchannel

    for i:= 0; i < 10; i++ {
        channels[i] = make(chan int) //åˆ‡ç‰‡ä¸­æ”¾å…¥ä¸€ä¸ªchannel
        go Process(channels[i])      //å¯åŠ¨åç¨‹ï¼Œä¼ ä¸€ä¸ªç®¡é“ç”¨äºé€šä¿¡
    }

    for i, ch := range channels {  //éå†åˆ‡ç‰‡ï¼Œç­‰å¾…å­åç¨‹ç»“æŸ
        <-ch
        fmt.Println("Routine ", i, " quit!")
    }
}
```

**WaitGroup**

æ·»åŠ è®¡æ•°ï¼ˆ WaitGroup.Add ï¼‰åº”åœ¨åˆ›å»ºä»»åŠ¡å’Œç­‰å¾…ä¹‹å‰ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç­‰å¾…æå‰è§£é™¤ã€‚

```go
package main

import "sync"

func main() {
	var wg sync.WaitGroup

	for i := 0; i < 10; i++ {
		wg.Add(1)
		go func(id int) {
			defer wg.Done()
			println(id, "done.")
		}(i)
	}

	wg.Wait()
}
```

**context**

```go
package main

import (
	"context"
	"fmt"
)

func main() {
	gen := func(ctx context.Context) <-chan int {
		dst := make(chan int)
		n := 1
		go func() {
			for {
				select {
				case <-ctx.Done():
					return // returning not to leak the goroutine
				case dst <- n:
					n++
				}
			}
		}()
		return dst
	}

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel() // cancel when we are finished consuming integers

	for n := range gen(ctx) {
		fmt.Println(n)
		if n == 5 {
			break
		}
	}
}
```

**mutex**

```go
package main

import "sync"

func main() {
	var lock sync.Mutex
	lock.Lock()
	go func() {
		defer lock.Unlock()
		println("done.")
	}()
	lock.Lock()
	lock.Unlock()
	println("exit")
}
```

## ç»ˆæ­¢ä»»åŠ¡

ä¸»åŠ¨ç»“æŸä»»åŠ¡ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ã€‚ 

- è°ƒç”¨ runtime.Goexit ç»ˆæ­¢ä»»åŠ¡ã€‚ 
- è°ƒç”¨ os.Exit ç»“æŸè¿›ç¨‹ã€‚

## GOMAXPROCS - è¿›ç¨‹æ•°ï¼ˆingï¼‰

ä¸€èˆ¬æ¥è®²ï¼Œç¨‹åºè¿è¡Œæ—¶å°±å°†GOMAXPROCSå¤§å°è®¾ç½®ä¸ºCPUæ ¸æ•°ï¼Œå¯è®©Goç¨‹åºå……åˆ†åˆ©ç”¨CPUã€‚ 

GOMAXPROCS å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œåœ¨æŸäº›IOå¯†é›†å‹çš„åº”ç”¨é‡Œï¼Œè¿™ä¸ªå€¼å¯èƒ½å¹¶ä¸æ„å‘³ç€æ€§èƒ½æœ€å¥½ã€‚ ç†è®ºä¸Šå½“æŸä¸ªGoroutineè¿›å…¥ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªæ–°çš„Mè¢«å¯ç”¨æˆ–åˆ›å»ºï¼Œç»§ç»­å æ»¡CPUã€‚ä»»ä½•æ—¶å€™éƒ½åªæœ‰å‡ ä¸ªå‚ä¸å¹¶å‘ä»»åŠ¡æ‰§è¡Œï¼Œå…¶ä»–å¤„äºä¼‘çœ çŠ¶æ€ï¼ˆå¯ä»¥æŸ¥çœ‹GMPæ¨¡å‹ï¼‰ã€‚

è¿è¡Œæ—¶å¯ä»¥è®¾ç½®GOMAXPROCSçš„ç¯å¢ƒå˜é‡,ç”¨timeå‘½ä»¤æŸ¥çœ‹è¿è¡Œæ—¶é—´ã€‚ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨`runtime.GOMAXPROCS()`è®¾ç½®Pçš„ä¸ªæ•°

```bash
time GOMAXPROCS=1 ./test
```

é™¤å¹¶å‘æ§åˆ¶å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ ` GOGC` ã€ `GOMEMLIMIT `è°ƒæ•´åƒåœ¾å›æ”¶é¢‘ç‡å’Œæœ€å¤§é˜ˆå€¼ã€‚

## æŒ‚èµ·

ä½¿ç”¨`runtime.Gosched()`æš‚æ—¶æŒ‚èµ·ä»»åŠ¡ï¼Œé‡Šæ”¾çº¿ç¨‹å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å½“å‰ä»»åŠ¡è¢«æ”¾å›ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹æ¬¡è¢«æŸä¸ªçº¿ç¨‹é‡æ–°è·å–åç»§ç»­æ‰§è¡Œã€‚

```go
go func() {
    defer wg.Done()
    <- b
    for i := 0; i < 5; i++ {
        println("b", i)
        if i == 2 { 
            runtime.Gosched() 
        }
    }
}()
```

## é¡ºåºæ‰§è¡Œ

```go
func main() {
    const CNT = 5
    var wg sync.WaitGroup
    wg.Add(CNT)
    var chans [CNT]chan struct{}

    for i := 0; i < CNT; i++ {
        chans[i] = make(chan struct{})
        go func(id int){
            defer wg.Done()
            <- chans[id]
            println(id)
        }(i)
    }
    // æ¬¡åºï¼ˆå»¶æ—¶ï¼Œç»™è°ƒåº¦å™¨æ—¶é—´å¤„ç†ï¼‰
    for _, x := range []int{4, 0, 1, 3, 2} {
        close(chans[x])
    	time.Sleep(time.Millisecond * 10)
    }
    wg.Wait()
}
```

## çº¿ç¨‹ç®¡ç†

Go è¯­è¨€æ—¢ç„¶ä¸“é—¨å°†çº¿ç¨‹è¿›ä¸€æ­¥æŠ½è±¡ä¸º Goroutineï¼Œè‡ªç„¶ä¹Ÿå°±ä¸å¸Œæœ›æˆ‘ä»¬å¯¹çº¿ç¨‹åšè¿‡å¤šçš„æ“ä½œï¼Œäº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œ å¤§éƒ¨åˆ†çš„ç”¨æˆ·ä»£ç å¹¶ä¸éœ€è¦çº¿ç¨‹çº§çš„æ“ä½œã€‚

 `runtime.LockOSThread` ä¼šå°†å½“å‰ Goroutine é”åœ¨ä¸€ä¸ªå›ºå®šçš„ OS çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚

`LockOSThread/UnlockOSThread` ä¹Ÿæ˜¯ç›®å‰å”¯ä¸€ä¸€ä¸ªèƒ½å¤Ÿè®© M é€€å‡ºçš„åšæ³•ï¼ˆå°† Goroutine é”åœ¨ OS çº¿ç¨‹ä¸Šï¼Œä¸”åœ¨ Goroutine æ­»äº¡é€€å‡ºæ—¶ä¸è°ƒç”¨ Unlock æ–¹æ³•ï¼‰ã€‚ 

> è¯¦æƒ…çœ‹åŸç†

## :point_right:goroutineæ€»ç»“

- å¼€å‘æ—¶è¦æ³¨æ„ä¿è¯goç¨‹é¡ºåˆ©æ‰§è¡Œä¸ç»“æŸã€‚
- ä¸è¦é¢‘ç¹è°ƒç”¨ GOMAXPROCS ï¼Œå®ƒä¼šå¯¼è‡´ STWï¼Œå½±å“æ€§èƒ½ã€‚
- ä½¿ç”¨WaitGroupå’Œcontextæ¥æ§åˆ¶goç¨‹æ´»åŠ¨ã€‚
- ä½¿ç”¨channelé€šä¿¡æ¥ä»£æ›¿å†…å­˜å…±äº«ï¼ˆcspï¼‰
- ä»¥å‚æ•°æ–¹å¼ä¼ å…¥å¤–éƒ¨å®¹å™¨ï¼Œä½†è¦é¿å…å’Œå…¶ä»–å¹¶å‘ä»»åŠ¡ç«äº‰ï¼ˆdata raceï¼‰ã€‚

# sync-å…±äº«å˜é‡å®‰å…¨

é€šé“å¹¶éç”¨æ¥å–ä»£é”ï¼Œå„æœ‰ä¸åŒä½¿ç”¨åœºæ™¯ã€‚ 

é€šé“è§£å†³é«˜çº§åˆ«é€»è¾‘å±‚æ¬¡å¹¶å‘æ¶æ„ï¼Œé”åˆ™ç”¨æ¥ä¿æŠ¤ä½çº§åˆ«å±€éƒ¨ä»£ç ï¼ˆå¤šgoroutineä¹‹é—´çš„å…±äº«å˜é‡ï¼‰å®‰å…¨ã€‚ 

- ç«Ÿæ€æ¡ä»¶ï¼šå¤šçº¿ç¨‹åŒæ—¶è¯»å†™å…±äº«èµ„æºï¼ˆç«Ÿæ€èµ„æºï¼‰ã€‚ 
- ä¸´ç•ŒåŒºï¼šè¯»å†™ç«Ÿæ€èµ„æºçš„ä»£ç ç‰‡æ®µã€‚ 

é”çš„ç§ç±»ï¼š

- äº’æ–¥é”ï¼šåŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚ 
- è¯»å†™é”ï¼šå†™ç‹¬å ï¼ˆå…¶ä»–è¯»å†™å‡è¢«é˜»å¡ï¼‰ï¼Œè¯»å…±äº«ã€‚ 
- ä¿¡å·é‡ï¼šå…è®¸æŒ‡å®šæ•°é‡çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚ 
- è‡ªæ—‹é”ï¼šå¤±è´¥åï¼Œä»¥å¾ªç¯ç§¯æå°è¯•ã€‚ï¼ˆæ— ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°ç²’åº¦ï¼‰ 
- æ‚²è§‚é”ï¼šæ“ä½œå‰ç‹¬å é”å®šã€‚ 
- ä¹è§‚é”ï¼šå‡å®šæ— ç«äº‰ï¼Œåç½®æ£€æŸ¥ã€‚ï¼ˆLock Free, CASï¼‰

## ç«äº‰æ£€æµ‹

Goå·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½åŠ¨æ€åˆ†æå·¥å…·ï¼Œç«äº‰æ£€æŸ¥å™¨ï¼ˆthe race detectorï¼‰ã€‚åªè¦åœ¨go buildï¼Œgo runæˆ–è€…go testå‘½ä»¤åé¢åŠ ä¸Š`-race`çš„flagå³å¯ã€‚

```bash
go build -race && ./test
```

## sync.Mutexäº’æ–¥é”

Go æ ‡å‡†åº“ä¸­æä¾›äº† sync.Mutex äº’æ–¥é”ç±»å‹åŠå…¶ä¸¤ä¸ªæ–¹æ³•ï¼š

- Lock åŠ é”
- Unlock é‡Šæ”¾é”

```go
type data struct {
	sync.Mutex
}

func (d *data) do() {
	prefix()
	func() {
		d.Lock()
		defer d.Unlock()
		doing()
	}()
	suffix()
}
```

- äº’æ–¥é”è¦å°½æ—©é‡Šæ”¾
- ä¸æ”¯æŒé‡å…¥é”ï¼ˆè¿ç»­å¤šæ¬¡é”å…¥ï¼Œé‡Šæ”¾ï¼‰ã€‚

## sync.RWMutexè¯»å†™é”

è¯»å†™é”åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œè¯»é”æ˜¯å…è®¸åŒæ—¶æ‰§è¡Œçš„ï¼Œä½†å†™é”æ˜¯äº’æ–¥çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š

- è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œæ²¡æœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œè¯»é”æ˜¯æ— é˜»å¡çš„ï¼Œå¤šä¸ªåç¨‹å¯ä»¥åŒæ—¶è·å¾—è¯»é”ã€‚
- å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œå­˜åœ¨å†™é”ï¼Œå…¶ä»–å†™é”é˜»å¡ã€‚
- å†™é”ä¸è¯»é”æ˜¯äº’æ–¥çš„ï¼Œå¦‚æœå­˜åœ¨è¯»é”ï¼Œå†™é”é˜»å¡ï¼Œå¦‚æœå­˜åœ¨å†™é”ï¼Œè¯»é”é˜»å¡ã€‚

Go æ ‡å‡†åº“ä¸­æä¾›äº† sync.RWMutex äº’æ–¥é”ç±»å‹åŠå…¶å››ä¸ªæ–¹æ³•ï¼š

- Lock åŠ å†™é”
- Unlock é‡Šæ”¾å†™é”
- RLock åŠ è¯»é”
- RUnlock é‡Šæ”¾è¯»é”

```go
type RWLock struct {
	count int
	mu    sync.RWMutex
}

func (l *RWLock) Write() {
	l.mu.Lock()
    defer l.mu.Unlock()
	l.count++
	
}

func (l *RWLock) Read() {
	l.mu.RLock()
    defer l.mu.RUnlock()
	_ = l.count
}
```

## sync.Condæ¡ä»¶å˜é‡

`sync.Cond` æ¡ä»¶å˜é‡ç”¨æ¥åè°ƒæƒ³è¦è®¿é—®å…±äº«èµ„æºçš„é‚£äº› goroutineï¼Œå½“å…±äº«èµ„æºçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥ç”¨æ¥é€šçŸ¥è¢«äº’æ–¥é”é˜»å¡çš„ goroutineã€‚

ä½¿ç”¨åœºæ™¯ï¼š

`sync.Cond` ç»å¸¸ç”¨åœ¨å¤šä¸ª goroutine ç­‰å¾…ï¼Œä¸€ä¸ª goroutine é€šçŸ¥ï¼ˆäº‹ä»¶å‘ç”Ÿï¼‰çš„åœºæ™¯ã€‚å¦‚æœæ˜¯ä¸€ä¸ªé€šçŸ¥ï¼Œä¸€ä¸ªç­‰å¾…ï¼Œä½¿ç”¨äº’æ–¥é”æˆ– channel å°±èƒ½æå®šäº†ã€‚æ¯”å¦‚ï¼šæœ‰ä¸€ä¸ªåç¨‹åœ¨å¼‚æ­¥åœ°æ¥æ”¶æ•°æ®ï¼Œå‰©ä¸‹çš„å¤šä¸ªåç¨‹å¿…é¡»ç­‰å¾…è¿™ä¸ªåç¨‹æ¥æ”¶å®Œæ•°æ®ï¼Œæ‰èƒ½è¯»å–åˆ°æ­£ç¡®çš„æ•°æ®ã€‚

```go
var done = false

func read(name string, c *sync.Cond) {
	c.L.Lock()
	for !done {
		c.Wait()
	}
	log.Println(name, "starts reading")
	c.L.Unlock()
}

func write(name string, c *sync.Cond) {
	log.Println(name, "starts writing")
	time.Sleep(time.Second)
	c.L.Lock()
	done = true
	c.L.Unlock()
	log.Println(name, "wakes all")
	c.Broadcast()
}

func main() {
	cond := sync.NewCond(&sync.Mutex{})

	go read("reader1", cond)
	go read("reader2", cond)
	go read("reader3", cond)
	write("writer", cond)

	time.Sleep(time.Second * 3)
}
```

## sync.Onceå•æ¬¡æ‰§è¡Œ

`sync.Once` æ˜¯ Go æ ‡å‡†åº“æä¾›çš„ä½¿å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡çš„å®ç°ï¼Œå¸¸åº”ç”¨äºå•ä¾‹æ¨¡å¼ï¼Œä¾‹å¦‚åˆå§‹åŒ–é…ç½®ã€ä¿æŒæ•°æ®åº“è¿æ¥ç­‰ã€‚

```go
func main() {
    var once sync.Once
    f1 := func() { println("1") }
    f2 := func() { println("2") }
    once.Do(f1)
    // ä»¥ä¸‹ç›®æ ‡å‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚
    once.Do(f1)
    once.Do(f2)
    once.Do(f2)
}
```

- å£°æ˜ä¸€ä¸ª `sync.Once` åªèƒ½æ‰§è¡Œä¸€æ¬¡.Do()å‡½æ•°

## sync.Poolå¤ç”¨ä¸´æ—¶å¯¹è±¡

sync.Pool ä¿å­˜å’Œå¤ç”¨ä¸´æ—¶å¯¹è±¡ï¼Œå‡å°‘å†…å­˜åˆ†é…ï¼Œé™ä½ GC å‹åŠ›ã€‚

sync.Pool çš„å¤§å°æ˜¯å¯ä¼¸ç¼©çš„ï¼Œé«˜è´Ÿè½½æ—¶ä¼šåŠ¨æ€æ‰©å®¹ï¼Œå­˜æ”¾åœ¨æ± ä¸­çš„å¯¹è±¡å¦‚æœä¸æ´»è·ƒäº†ä¼šè¢«è‡ªåŠ¨æ¸…ç†ã€‚

- `Get()` ç”¨äºä»å¯¹è±¡æ± ä¸­è·å–å¯¹è±¡ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯ `interface{}`ï¼Œå› æ­¤éœ€è¦ç±»å‹è½¬æ¢ã€‚
- `Put()` åˆ™æ˜¯åœ¨å¯¹è±¡ä½¿ç”¨å®Œæ¯•åï¼Œè¿”å›å¯¹è±¡æ± ã€‚

```go
var studentPool = sync.Pool{
    New: func() interface{} { 
        return new(Student) 
    },
}

stu := studentPool.Get().(*Student)
json.Unmarshal(buf, stu)
studentPool.Put(stu)
```

## sync.Mapå¹¶å‘å®‰å…¨çš„map

Goè¯­è¨€ä¸­çš„ map åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œåªè¯»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒæ—¶è¯»å†™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚

```go
package main

import (
      "fmt"
      "sync"
)

func main() {
    var scene sync.Map

    // å°†é”®å€¼å¯¹ä¿å­˜åˆ°sync.Map
    scene.Store("greece", 97)
    scene.Store("london", 100)
    scene.Store("egypt", 200)

    // ä»sync.Mapä¸­æ ¹æ®é”®å–å€¼
    fmt.Println(scene.Load("london"))

    // æ ¹æ®é”®åˆ é™¤å¯¹åº”çš„é”®å€¼å¯¹
    scene.Delete("london")

    // éå†æ‰€æœ‰sync.Mapä¸­çš„é”®å€¼å¯¹
    scene.Range(func(k, v interface{}) bool {
        fmt.Println("iterate:", k, v)
        return true
    })
}
```



## :point_right:é”æ€»ç»“

- å¼€å‘æ—¶ï¼Œä¸ºäº†æ•ˆç‡å’Œè§„èŒƒï¼Œå°½é‡ä¿è¯é”çš„é¢—ç²’åº¦å°ï¼ŒåŠæ—©é‡Šæ”¾ã€‚

# unsafe

## unsafe.Sizeof, Alignof å’Œ Offsetof

unsafe.Sizeofå‡½æ•°è¿”å›æ“ä½œæ•°åœ¨å†…å­˜ä¸­çš„å­—èŠ‚å¤§å°ï¼Œå‚æ•°å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯å®ƒå¹¶ä¸ä¼šå¯¹è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ã€‚

```go
import "unsafe"
fmt.Println(unsafe.Sizeof(float64(0))) // "8"
```

`unsafe.Alignof` å‡½æ•°è¿”å›å¯¹åº”å‚æ•°çš„ç±»å‹éœ€è¦å¯¹é½çš„å€æ•°ã€‚å’Œ Sizeof ç±»ä¼¼ï¼Œ Alignof ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œå¯¹åº”ä¸€ä¸ªå¸¸é‡ã€‚é€šå¸¸æƒ…å†µä¸‹å¸ƒå°”å’Œæ•°å­—ç±»å‹éœ€è¦å¯¹é½åˆ°å®ƒä»¬æœ¬èº«çš„å¤§å°ï¼ˆæœ€å¤š8ä¸ªå­—èŠ‚ï¼‰ï¼Œå…¶å®ƒçš„ç±»å‹å¯¹é½åˆ°æœºå™¨å­—å¤§å°ã€‚

`unsafe.Offsetof` å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå­—æ®µ `x.f`ï¼Œç„¶åè¿”å› `f` å­—æ®µç›¸å¯¹äº `x` èµ·å§‹åœ°å€çš„åç§»é‡ï¼ŒåŒ…æ‹¬å¯èƒ½çš„ç©ºæ´ã€‚

## unsafe.Pointer

å¤§å¤šæ•°æŒ‡é’ˆç±»å‹ä¼šå†™æˆ`*T`ï¼Œè¡¨ç¤ºæ˜¯â€œä¸€ä¸ªæŒ‡å‘Tç±»å‹å˜é‡çš„æŒ‡é’ˆâ€ã€‚unsafe.Pointeræ˜¯ç‰¹åˆ«å®šä¹‰çš„ä¸€ç§æŒ‡é’ˆç±»å‹

```go
package math

func Float64bits(f float64) uint64 { return *(*uint64)(unsafe.Pointer(&f)) }

fmt.Printf("%#016x\n", Float64bits(1.0)) // "0x3ff0000000000000"
```
